<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0099)Module CustomFields - Dolibarr Wiki.html#Exporting_your_customized_CustomFields_files -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" class="client-chrome client-chrome-4 client-webkit client-win"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="verify-v1" content="HMNutRwqmhagMMJPRLLAFKlwRnifyx4SoJjYN+fyZV0=">
		<meta name="msvalidate.01" content="97D254FD131581C03545FB5D9A228AD7">
		
		<meta name="generator" content="MediaWiki 1.17.0">
<link rel="alternate" type="application/x-wiki" title="Edit" href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit">
<link rel="edit" title="Edit" href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit">
<link rel="shortcut icon" href="http://wiki.dolibarr.org/skins/dolibarr/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.dolibarr.org/opensearch_desc.php" title="Dolibarr Wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.dolibarr.org/api.php?action=rsd">
<link rel="copyright" href="http://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="Dolibarr Wiki Atom feed" href="http://wiki.dolibarr.org/index.php?title=Special:RecentChanges&feed=atom">		<title>Module CustomFields - Dolibarr Wiki</title>
		<link rel="stylesheet" href="http://wiki.dolibarr.org/load.php?debug=false&lang=en&modules=mediawiki.legacy.commonPrint%2Cshared&only=styles&skin=dolibarr&*">
<link rel="stylesheet" href="http://wiki.dolibarr.org/skins/dolibarr/main.css?301" media="screen"><meta name="ResourceLoaderDynamicStyles" content="">		<script async="" src="http://www.google-analytics.com/analytics.js"></script><script>if ( window.mediaWiki ) {
	mediaWiki.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Module_CustomFields", "wgTitle": "Module CustomFields", "wgAction": "view", "wgArticleId": 4467, "wgIsArticle": true, "wgUserName": "Lrq3000", "wgUserGroups": ["*", "user", "autoconfirmed", "emailconfirmed"], "wgCurRevisionId": 33197, "wgCategories": ["Complementary modules", "CustomFields", "FAQ EN"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": []});
}
</script>		<link href="https://plus.google.com/+DolibarrOrg" rel="publisher">




		<!-- Head Scripts -->
<style type="text/css">/*<![CDATA[*/
.source-php {line-height: normal;}
.source-php li, .source-php pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for php
 * CSS class: source-php, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.php.source-php .de1, .php.source-php .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.php.source-php  {font-family:monospace;}
.php.source-php .imp {font-weight: bold; color: red;}
.php.source-php li, .php.source-php .li1 {font-weight: normal; vertical-align:top;}
.php.source-php .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.php.source-php .li2 {font-weight: bold; vertical-align:top;}
.php.source-php .kw1 {color: #505000;}
.php.source-php .kw2 {color: #000000; font-weight: bold;}
.php.source-php .kw3 {color: #505000;}
.php.source-php .kw4 {color: #009900; font-weight: bold;}
.php.source-php .co1 {color: #666666; font-style: italic;}
.php.source-php .co2 {color: #666666; font-style: italic;}
.php.source-php .co3 {color: #0000cc; font-style: italic;}
.php.source-php .co4 {color: #009933; font-style: italic;}
.php.source-php .coMULTI {color: #666666; font-style: italic;}
.php.source-php .es0 {color: #000099; font-weight: bold;}
.php.source-php .es1 {color: #000099; font-weight: bold;}
.php.source-php .es2 {color: #660099; font-weight: bold;}
.php.source-php .es3 {color: #660099; font-weight: bold;}
.php.source-php .es4 {color: #006699; font-weight: bold;}
.php.source-php .es5 {color: #006699; font-weight: bold; font-style: italic;}
.php.source-php .es6 {color: #009933; font-weight: bold;}
.php.source-php .es_h {color: #000099; font-weight: bold;}
.php.source-php .br0 {color: #009900;}
.php.source-php .sy0 {color: #339933;}
.php.source-php .sy1 {color: #000000; font-weight: bold;}
.php.source-php .st0 {color: #0000ff;}
.php.source-php .st_h {color: #0000ff;}
.php.source-php .nu0 {color: #cc66cc;}
.php.source-php .nu8 {color: #208080;}
.php.source-php .nu12 {color: #208080;}
.php.source-php .nu19 {color:#800080;}
.php.source-php .me1 {color: #004000;}
.php.source-php .me2 {color: #004000;}
.php.source-php .re0 {color: #000088;}
.php.source-php .ln-xtra, .php.source-php li.ln-xtra, .php.source-php div.ln-xtra {background-color: #ffc;}
.php.source-php span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-sql {line-height: normal;}
.source-sql li, .source-sql pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for sql
 * CSS class: source-sql, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.sql.source-sql .de1, .sql.source-sql .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.sql.source-sql  {font-family:monospace;}
.sql.source-sql .imp {font-weight: bold; color: red;}
.sql.source-sql li, .sql.source-sql .li1 {font-weight: normal; vertical-align:top;}
.sql.source-sql .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.sql.source-sql .li2 {font-weight: bold; vertical-align:top;}
.sql.source-sql .kw1 {color: #505000;}
.sql.source-sql .co1 {color: #666666; font-style: italic;}
.sql.source-sql .co2 {color: #666666; font-style: italic;}
.sql.source-sql .coMULTI {color: #666666; font-style: italic;}
.sql.source-sql .es0 {color: #000099; font-weight: bold;}
.sql.source-sql .br0 {color: #66cc66;}
.sql.source-sql .sy0 {color: #66cc66;}
.sql.source-sql .st0 {color: #0000ff;}
.sql.source-sql .nu0 {color: #cc66cc;}
.sql.source-sql .ln-xtra, .sql.source-sql li.ln-xtra, .sql.source-sql div.ln-xtra {background-color: #ffc;}
.sql.source-sql span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style>		<script type="text/javascript" src="./Module CustomFields - Dolibarr Wiki_files/index.php"><!-- site js --></script>


<!-- LDR Google plusone -->
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>


<style>@-webkit-keyframes popfshjafuapmborqhbndcpfwbmbvpsjyalfjemi {50% {-webkit-transform:scale(1.2);}100% {-webkit-transform:scale(1);}}@keyframes popfshjafuapmborqhbndcpfwbmbvpsjyalfjemi {50% {-webkit-transform:scale(1.2);transform:scale(1.2);}100% {-webkit-transform:scale(1);transform:scale(1);}}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.fshjafuapmborqhbndcpfwbmbvpsjyalfjemi-blocked{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;color:#AAA !important;display:inline !important;text-decoration:line-through !important;}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi br{display:block !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi span{background:transparent !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi div{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi a{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}a#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi-gear{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;text-decoration:none !important;position:absolute !important;display:none !important;font-size:20px !important;width:20px !important;height:20px !important;line-height:20px !important;text-align:center !important;background-color:rgba(255,255,255,.8) !important;background-image:url(chrome-extension://mlomiejdfkolichcflejclcbmpeaniij/data/images/gear.svg) !important;background-size:16px 16px !important;background-position:center center !important;background-repeat:no-repeat !important;text-decoration:none !important;}a#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi-gear:hover{-webkit-animation-name:popfshjafuapmborqhbndcpfwbmbvpsjyalfjemi !important;animation-name:popfshjafuapmborqhbndcpfwbmbvpsjyalfjemi !important;-webkit-animation-duration:0.3s !important;animation-duration:0.3s !important;}#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi:hover #fshjafuapmborqhbndcpfwbmbvpsjyalfjemi-gear{text-decoration:none !important;display:inline-block !important;}@media print{#fshjafuapmborqhbndcpfwbmbvpsjyalfjemi{display:none !important;}}</style></head>


<body class="mediawiki ltr ns-0 ns-subject page-Module_CustomFields skin-dolibarr">


<div class="htmldoc-ignore">
<!-- LDR Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9049390-2', 'dolibarr.org');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
</div>


<div id="globalWrapper">
	<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<div class="htmldoc-ignore">
				<h1 id="firstHeading" class="firstHeading">Module CustomFields</h1>
		</div>
				<div id="bodyContent">
						<div class="htmldoc-ignore">
			<h3 id="siteSub">From Dolibarr Wiki</h3>
			</div>
						<div id="contentSub"></div>
												<!-- start content -->
			<div style="text-align:center; float:right; font-size:80%; background: #eef; border: 1px solid #ccf; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding: 1px; height: 92px; min-width: 100px;">
<p><a href="http://wiki.dolibarr.org/index.php/User_documentation" title="User documentation">Return to user<br>documentation index</a><br>
<a href="http://wiki.dolibarr.org/index.php/User_documentation" title="User documentation"><img alt="File Doc user.png" src="./Module CustomFields - Dolibarr Wiki_files/File_Doc_user.png" width="48" height="48"></a>
</p>
</div>
<div style="text-align:center; float:right; font-size:80%; background: #eef; border: 1px solid #ccf; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding: 1px; height: 92px">
<p><a href="http://wiki.dolibarr.org/index.php/Developer_documentation" title="Developer documentation">Return to developer<br>documentation index</a><br>
</p>
<a href="http://wiki.dolibarr.org/index.php/Developer_documentation" title="Developer documentation"><img alt="File Doc dev.png" src="./Module CustomFields - Dolibarr Wiki_files/File_Doc_dev.png" width="48" height="48"></a></div>
<div>
<table align="right" border="0" width="340px" cellpadding="2" cellspacing="0" class="dolbox">
<tbody><tr>
<th colspan="2" style="background-color: #e9e9ef"><b>CustomFields</b>
</th></tr>
<tr>
<td valign="top" nowrap="nowrap"> Numero/ID of module </td>
<td align="center" nowrap="nowrap"> 8500
</td></tr>
<tr>
<td valign="top" nowrap="nowrap"> User doc. of module </td>
<td align="center" nowrap="nowrap"> This page
</td></tr>
<tr>
<td valign="top" nowrap="nowrap"> Developer doc. of module </td>
<td align="center" nowrap="nowrap"> <a href="Module CustomFields - Dolibarr Wiki.html_Dev" title="Module CustomFields Dev">Module_CustomFields_Dev</a>
</td></tr></tbody></table>
</div>
<p>This documentation is about the external module CustomFields in branch v3. For previous versions, please read the included README inside the archive, although most of the documentation here is also valid for those older versions (particularly for branch V2 which is the Free edition).
</p><p>For the native <a href="http://wiki.dolibarr.org/index.php/Extrafields" title="Extrafields">Extrafields</a> module, see the related page.
</p><p>You can also jump directly to <a href="Module CustomFields - Dolibarr Wiki.html_Cases" title="Module CustomFields Cases">Module_CustomFields_Cases</a> wiki page for a collection of practical examples.
</p><p><br>
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2> <span class="toctoggle">[<a id="togglelink" class="internal" href="Module CustomFields - Dolibarr Wiki.html#">hide</a>]</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Module CustomFields - Dolibarr Wiki.html#Informations"><span class="tocnumber">1</span> <span class="toctext">Informations</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Module CustomFields - Dolibarr Wiki.html#Description"><span class="tocnumber">2</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Module CustomFields - Dolibarr Wiki.html#Understanding_CustomFields"><span class="tocnumber">3</span> <span class="toctext">Understanding CustomFields</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Module CustomFields - Dolibarr Wiki.html#Features_overview"><span class="tocnumber">4</span> <span class="toctext">Features overview</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="Module CustomFields - Dolibarr Wiki.html#Requirements"><span class="tocnumber">5</span> <span class="toctext">Requirements</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="Module CustomFields - Dolibarr Wiki.html#Usage"><span class="tocnumber">6</span> <span class="toctext">Usage</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="Module CustomFields - Dolibarr Wiki.html#Enabling_the_module"><span class="tocnumber">6.1</span> <span class="toctext">Enabling the module</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="Module CustomFields - Dolibarr Wiki.html#Creating_a_custom_field"><span class="tocnumber">6.2</span> <span class="toctext">Creating a custom field</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="Module CustomFields - Dolibarr Wiki.html#Modifying_a_custom_field"><span class="tocnumber">6.3</span> <span class="toctext">Modifying a custom field</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="Module CustomFields - Dolibarr Wiki.html#Deleting_a_custom_field"><span class="tocnumber">6.4</span> <span class="toctext">Deleting a custom field</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="Module CustomFields - Dolibarr Wiki.html#Translation_of_a_custom_field.27s_label"><span class="tocnumber">6.5</span> <span class="toctext">Translation of a custom field's label</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="Module CustomFields - Dolibarr Wiki.html#Testing_your_custom_fields_with_the_PDFTest_module"><span class="tocnumber">6.6</span> <span class="toctext">Testing your custom fields with the PDFTest module</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="Module CustomFields - Dolibarr Wiki.html#Implementing_in_ODT_templates"><span class="tocnumber">6.7</span> <span class="toctext">Implementing in ODT templates</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="Module CustomFields - Dolibarr Wiki.html#Implementing_in_PDF_templates"><span class="tocnumber">6.8</span> <span class="toctext">Implementing in PDF templates</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="Module CustomFields - Dolibarr Wiki.html#Implementing_in_php_code_.28dolibarr_core_modules_or_your_own_module.29"><span class="tocnumber">6.9</span> <span class="toctext">Implementing in php code (dolibarr core modules or your own module)</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="Module CustomFields - Dolibarr Wiki.html#Do.27s_and_don.27t_to_avoid_slowdowns_when_implementing_CustomFields"><span class="tocnumber">6.10</span> <span class="toctext">Do's and don't to avoid slowdowns when implementing CustomFields</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="Module CustomFields - Dolibarr Wiki.html#Constraints"><span class="tocnumber">7</span> <span class="toctext">Constraints</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="Module CustomFields - Dolibarr Wiki.html#Adding_a_constrained.2Flinked_custom_field"><span class="tocnumber">7.1</span> <span class="toctext">Adding a constrained/linked custom field</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="Module CustomFields - Dolibarr Wiki.html#Smart_Value_Substitution"><span class="tocnumber">7.2</span> <span class="toctext">Smart Value Substitution</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="Module CustomFields - Dolibarr Wiki.html#Remote_Fields_Access_via_a_constrained_field"><span class="tocnumber">7.3</span> <span class="toctext">Remote Fields Access via a constrained field</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="Module CustomFields - Dolibarr Wiki.html#Recursive_Remote_Fields_Access_via_a_constrained_field"><span class="tocnumber">7.4</span> <span class="toctext">Recursive Remote Fields Access via a constrained field</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="Module CustomFields - Dolibarr Wiki.html#Manage_constrained_fields_programmatically"><span class="tocnumber">7.5</span> <span class="toctext">Manage constrained fields programmatically</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="Module CustomFields - Dolibarr Wiki.html#Extra_options"><span class="tocnumber">8</span> <span class="toctext">Extra options</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="Module CustomFields - Dolibarr Wiki.html#Recopy"><span class="tocnumber">8.1</span> <span class="toctext">Recopy</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="Module CustomFields - Dolibarr Wiki.html#Cascade"><span class="tocnumber">8.2</span> <span class="toctext">Cascade</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="Module CustomFields - Dolibarr Wiki.html#Duplicate"><span class="tocnumber">8.3</span> <span class="toctext">Duplicate</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="Module CustomFields - Dolibarr Wiki.html#Other_options"><span class="tocnumber">8.4</span> <span class="toctext">Other options</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="Module CustomFields - Dolibarr Wiki.html#Advanced_configuration"><span class="tocnumber">9</span> <span class="toctext">Advanced configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-29"><a href="Module CustomFields - Dolibarr Wiki.html#Changing_the_default_variable_prefix_for_fields_name"><span class="tocnumber">9.1</span> <span class="toctext">Changing the default variable prefix for fields name</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="Module CustomFields - Dolibarr Wiki.html#Changing_the_delimiter_for_Smart_Value_Substitution"><span class="tocnumber">9.2</span> <span class="toctext">Changing the delimiter for Smart Value Substitution</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="Module CustomFields - Dolibarr Wiki.html#Overloading_functions:_Adding_your_own_management_code_for_custom_fields"><span class="tocnumber">9.3</span> <span class="toctext">Overloading functions: Adding your own management code for custom fields</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="Module CustomFields - Dolibarr Wiki.html#Custom_AJAX_Functions"><span class="tocnumber">9.4</span> <span class="toctext">Custom AJAX Functions</span></a>
<ul>
<li class="toclevel-3 tocsection-33"><a href="Module CustomFields - Dolibarr Wiki.html#Attaching_AJAX_to_any_field"><span class="tocnumber">9.4.1</span> <span class="toctext">Attaching AJAX to any field</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="Module CustomFields - Dolibarr Wiki.html#Custom_cascading"><span class="tocnumber">9.4.2</span> <span class="toctext">Custom cascading</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-35"><a href="Module CustomFields - Dolibarr Wiki.html#Adding_a_new_sql_data_type"><span class="tocnumber">9.5</span> <span class="toctext">Adding a new sql data type</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="Module CustomFields - Dolibarr Wiki.html#Adding_the_support_of_a_new_module"><span class="tocnumber">9.6</span> <span class="toctext">Adding the support of a new module</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-37"><a href="Module CustomFields - Dolibarr Wiki.html#Example_cases"><span class="tocnumber">10</span> <span class="toctext">Example cases</span></a></li>
<li class="toclevel-1 tocsection-38"><a href="Module CustomFields - Dolibarr Wiki.html#Exporting_and_importing_your_CustomFields"><span class="tocnumber">11</span> <span class="toctext">Exporting and importing your CustomFields</span></a>
<ul>
<li class="toclevel-2 tocsection-39"><a href="Module CustomFields - Dolibarr Wiki.html#Exporting_and_importing_in_CSV_.28Excel.29_via_Dolibarr_tools"><span class="tocnumber">11.1</span> <span class="toctext">Exporting and importing in CSV (Excel) via Dolibarr tools</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="Module CustomFields - Dolibarr Wiki.html#Exporting_your_SQL_data"><span class="tocnumber">11.2</span> <span class="toctext">Exporting your SQL data</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="./Module CustomFields - Dolibarr Wiki_files/Module CustomFields - Dolibarr Wiki.html"><span class="tocnumber">11.3</span> <span class="toctext">Exporting your customized CustomFields files</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-42"><a href="Module CustomFields - Dolibarr Wiki.html#Updating_your_Dolibarr.2FCustomFields"><span class="tocnumber">12</span> <span class="toctext">Updating your Dolibarr/CustomFields</span></a></li>
<li class="toclevel-1 tocsection-43"><a href="Module CustomFields - Dolibarr Wiki.html#Troubleshooting"><span class="tocnumber">13</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-44"><a href="Module CustomFields - Dolibarr Wiki.html#General_advices_for_troubleshooting"><span class="tocnumber">13.1</span> <span class="toctext">General advices for troubleshooting</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_I_have_installed_CustomFields_but_it_doesn.27t_show_up_in_the_modules_administration_panel"><span class="tocnumber">13.2</span> <span class="toctext">Q: I have installed CustomFields but it doesn't show up in the modules administration panel</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_I.27m_trying_to_edit_a_constrained_customfield_parameters_in_the_admin_configuration_page.2C_but_everytime_I.C2.A0change_the_constraint_it_goes_back_to_None_.3F"><span class="tocnumber">13.3</span> <span class="toctext">Q: I'm trying to edit a constrained customfield parameters in the admin configuration page, but everytime I&nbsp;change the constraint it goes back to None&nbsp;?</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_I.27m_trying_to_delete_a_constrained_customfield_in_the_admin_configuration_page.2C_but_it_doesn.27t_work.21"><span class="tocnumber">13.4</span> <span class="toctext">Q: I'm trying to delete a constrained customfield in the admin configuration page, but it doesn't work!</span></a></li>
<li class="toclevel-2 tocsection-48"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_I_have_a_big_problem_with_my_fields.2C_and_I_want_to_delete_all_the_fields_and_reinitialize_the_customfields_table"><span class="tocnumber">13.5</span> <span class="toctext">Q: I have a big problem with my fields, and I want to delete all the fields and reinitialize the customfields table</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_CustomFields_produces_a_lot_of_weird_errors_anywhere_I_go_even_when_it_is_disabled.2C_what_should_I_do.3F"><span class="tocnumber">13.6</span> <span class="toctext">Q: CustomFields produces a lot of weird errors anywhere I go even when it is disabled, what should I do?</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_Whenever_I_try_to_create_a_custom_field_or_a_record.2C_I_get_an_error_.22Duplicate_entry_.271.27_for_key_.27PRIMARY.27.22"><span class="tocnumber">13.7</span> <span class="toctext">Q: Whenever I try to create a custom field or a record, I get an error "Duplicate entry '1' for key 'PRIMARY'"</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="Module CustomFields - Dolibarr Wiki.html#Q:_CustomFields_Pro_is_VERY_slow_when_it_is_enabled.2C_even_on_modules_datasheet_where_no_custom_field_was_created.21_.28aka_INFORMATION_SCHEMA_slowness.29"><span class="tocnumber">13.8</span> <span class="toctext">Q: CustomFields Pro is VERY slow when it is enabled, even on modules datasheet where no custom field was created! (aka INFORMATION_SCHEMA slowness)</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=1" title="Edit section: Informations">edit</a>]</span> <span class="mw-headline" id="Informations"> Informations </span></h1>
<table border="0" width="100%" cellpadding="0" cellspacing="0" class="dolbox">

<tbody><tr>
<td valign="top" style="max-width: 200px"> Module name </td>
<td> CustomFields
</td></tr>
<tr>
<td> Editor / Editeur </td>
<td> Larroque Stephen  - www.customfields.org
</td></tr>
<tr>
<td> Download or buy page / Page achat ou téléchargement</td>
<td> <a href="http://www.dolistore.com/search.php?search_query=customfield" class="external text" target="_blank">www.dolistore.com</a>
</td></tr>
<tr>
<td> Status / Statut / Estado </td>
<td>Stable
</td></tr>
<tr>
<td> Prerequisites / Prérequis</td>
<td> Dolibarr &lt;= 3.6.0-alpha. Dolibarr min version 3.1.0 &nbsp;&nbsp;
</td></tr>
<tr>
<td> Last update date / Date mise à jour fiche / Fecha última actualización </td>
<td> 2015-03-3
</td></tr>
<tr>
<td valign="top"> Note / Nota </td>
<td>
</td></tr></tbody></table>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=2" title="Edit section: Description">edit</a>]</span> <span class="mw-headline" id="Description"> Description </span></h1>
<p>This module allows the implementer to easily create and manage custom fields, and then use them in PDF and ODT documents, or in any other way you want.
</p><p>You can choose the datatype, the size, the label(s), the possible values, the value by default, and even constraints (links to other tables) and custom sql definitions and custom sql statements.
</p><p>The three main goals of CustomFields are to enable you to:
</p>
<ul><li> Easily create your own custom fields with your data type of choice.
</li><li> Automatically manage/create/update/delete custom fields records of datas.
</li><li> Easily use the custom fields in your ODT and PDF documents, or any other PHP code.
</li></ul>
<p>And the philosophy:
</p>
<ul><li> Standards-compliance.
</li><li> Independence with the Dolibarr code.
</li><li> Be reusable.
</li></ul>
<p>CustomFields has been made with the intention of being as portable, flexible, modular and reusable as possible, so that it can be adapted to any Dolibarr's module, and to (almost) any user's need (even if something isn't implemented, you can most probably just use a custom sql statement, the rest will be managed automatically, even with custom statements.).
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=3" title="Edit section: Understanding CustomFields">edit</a>]</span> <span class="mw-headline" id="Understanding_CustomFields"> Understanding CustomFields </span></h1>
<p>Technically speaking, this module is a simple wrapper for your sql database. It respects sql standards and manages them in a standard way.
</p><p>This means that you can modify your sql database with another tool (eg: phpMyAdmin), and the changes will be reflected inside CustomFields as well.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=4" title="Edit section: Features overview">edit</a>]</span> <span class="mw-headline" id="Features_overview"> Features overview </span></h1>
<p>- Natively support the modules: Invoices, Propales and Products/Services.
</p><p>- Full multilanguage support:
</p>
<ul><li> multilanguage in the administration gui (french and english for now, but can be translated by anyone using langs files)
</li><li> multilanguage user-defined custom fields labels
</li><li> multilanguage custom fields values (eg: yes/no select box can be translated to any language, same for enum user defined values). You can even translate the values of your dropdown boxes or your constrained fields.
</li></ul>
<p>- Several natively supported fields types&nbsp;:
</p>
<ul><li> Textbox
</li><li> Areabox
</li><li> YesNoBox
</li><li> TrueFalseBox
</li><li> DropdownBox (your own options)
</li><li> Date
</li><li> DateTime
</li><li> Integer
</li><li> Float
</li><li> Double
</li><li> Constrained (link to other tables)
</li><li> Other (custom type, defined by your own SQL command)
</li></ul>
<p>Note: you can add your own sql datatypes, see the related chapter.
</p><p>The last one is not a native support but permits you to easily set any SQL data type that is not yet implemented, and it will be managed as best as possible by the module (by default if it's unknown it will be shown as a textbox).
</p><p>- Custom sql statements to create complex fields&nbsp;: these custom sql statements will be executed after the creation/edition of the custom field definition.
</p><p>- Fully automated management of the customfields in the database and via triggers.
</p><p>- Extensible to any module, be it core module or third-party user-made module (see the related chapter).
</p><p>- Auto-detection and auto management of constraints (automatically find the primary key and choose the same data type and size) and auto management of their printing and edition (show them as a dropdown box).
</p><p>- Smart Value Substitution for constrained fields: tell which column(s) you care, and the module will print the remote column instead of the row id (see the related chapter).
</p><p>- Can define different custom fields PER module (you can have different custom fields for each module)
</p><p>- Easy to use in PDF and ODT templates (see the related chapter).
</p><p>- Works on mobile phones and tablets: no ajax, no javascript code, only standard html.
</p><p>- Elegant presentation in datasheet.
</p><p>- Supports all classic functions of a standard field: creation, edition, cloning, etc.
</p><p>- Clean and isolated: do not interfer with the normal functionning of Dolibarr, everything is separated. You can just delete the customfields and it will never do anything wrong with your Dolibarr install or your other datas.
</p><p>- Develop your own modules via CustomFields: CF provides many methods to automatically manage the inputs of a user and access custom fields values from anywhere in the code (from Dolibarr's core to your own module), and even a few generic functions to query any SQL request and help to manage them, with an automatic management of errors.
</p><p>- Code is very easy to edit/customize/reuse/port (fully commented and modular architecture, and no duplicates functionnalities).
</p><p>- Use of strict SQL standards, so it should work for any database following the minimum standards requirement (tested on MySQL, probably works for PostGreSQL and SQLite).
</p><p>- Secure: only authorized users can edit customfields (one whose rights include create and modify for the module)
</p><p>- Optimized and fast: cache whenever possible and super optimized sql requests and fast php code with as few loops as possible and low number of opcodes.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=5" title="Edit section: Requirements">edit</a>]</span> <span class="mw-headline" id="Requirements"> Requirements </span></h1>
<p>This module requires your database to support Foreign Keys for full functionalities, for example with MySQL you need to enable InnoDB, because MyISAM alone does not support foreign keys and referential integrity checks.
</p><p>However, in the case you really cannot enable Foreign Keys support in your database, CustomFields can still work in <a href="Module CustomFields - Dolibarr Wiki.html_Dev#SQL_Compatibility_mode" title="Module CustomFields Dev">compatibility mode</a>: you will get most of the features, constraints included, but your database will be a bit less clean.
</p><p>For more informations, please read the developper's documentation about the <a href="Module CustomFields - Dolibarr Wiki.html_Dev#SQL_Compatibility_mode" title="Module CustomFields Dev">SQL Compatibility mode</a>.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=6" title="Edit section: Usage">edit</a>]</span> <span class="mw-headline" id="Usage"> Usage </span></h1>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=7" title="Edit section: Enabling the module">edit</a>]</span> <span class="mw-headline" id="Enabling_the_module"> Enabling the module </span></h2>
<p>To use this module, you must first enable it. For this, with an administrator account, go on page "<b>Home - Setup - Modules</b>".
</p><p>Choose the tab where the module stand. Then click on "<b>Activate</b>".
</p><p>The module is now activated.
</p><p>If an icon appears at end of module line, click on it to access the setup page, specific to this module.
</p><p>Now you can choose the tab of the module for which you want to configure your custom fields.
</p><p>If the sql table does not exist yet, the module will allow you to create it automatically by clicking the button <b>Create table</b>.
</p><p>Note: when you update Dolibarr or the module, you should disable and re enable the module to activate the new functionnalities (particularly the support of new modules).
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=8" title="Edit section: Creating a custom field">edit</a>]</span> <span class="mw-headline" id="Creating_a_custom_field"> Creating a custom field </span></h2>
<p>After enabling the module and creating the table, you can now create a custom field.
</p><p>Click on the button <b>New field</b> on the bottom right hand corner of the page.
</p><p>You will then be presented with several options (bold are required):
</p>
<ul><li> Label: this option is disabled, because the label will automatically be the same as the Field Name, but you can translate it (set it) in language files (see the related chapter below).
</li><li> <b>Field Name</b>: sql field name. Choose any name you want, it just has to be alphanumeric without any space (you can use underscore '_'). You can also use remote sql columns names if you set a constrained field to enable Smart Value Substitution for this field (see the related chapter).
</li><li> <b>Type</b>: the type of the field. This is where you choose what kind of data your field will hold, and more importantly how it will be shown (eg: Textbox, DropdownBox, etc..). You can also choose <b>Other</b> and set your own SQL type (and size) by entering it in the Other box just below (Eg: int(11)  will create an int of max size 11 bits).
</li><li> Size, or for DropdownBox the Values: if you want to set a specific size, you can set it here. By default, the module will set the right size for most uses, but if you find that it's too limited, you set any value. Also, this is <b>required</b> if you set an DropdownBox type, and instead of setting the size you should here set the values that will be offered in the box (eg: "firstval","secondval","thirdval" WITH the quotes and commas).
</li><li> Accept null values: if enabled, the field will accept empty values. Else if disabled, a value will be required, and if an empty value is entered, the last non empty value will be used instead.
</li><li> Default value: you can set the default value when a field has not received any value by the user yet.
</li><li> Constraint: you can link the field to another table in the database. The field will then offer as choices the records in the remote table.
</li><li> Custom SQL Definition: this is used to add more sql commands to the sql definition of the field (such as comments, meta parameters or transformations).
</li></ul>
<p>Any SQL command you write here will be appended at the end of the automatically generated SQL statement to create the custom field.
</p><p>Eg: you create a custom field named "belowten" and want to make sure that it will never store any value above 10, you can set the following in the Custom SQL Definition (if supported by your DBMS):
</p>
<pre>CHECK belowten &lt; 10</pre>
<p>This will be appended to the automatically generated SQL creation statement, which would be something like this:
</p>
<pre>ALTER table ADD belowten int(11)</pre>
<p>With the appended Custom SQL Definition:
</p>
<pre>ALTER table ADD belowten int(11) CHECK belowten &lt; 10</pre>
<p>You can of course add multiple statements as long as they are doable in the same statement (you are not allowed to use ";" to add another request, you should then use Custom SQL Statement to do that).
</p>
<ul><li> Custom SQL Statement: any sql command can be entered here and will be issued <b>only ONCE</b> after the definition of the field (thus the commands won't be issued every time the field is shown, but only once when you create the field!). This is the same as using a third-party tool such as phpMyAdmin, and is just offered as a quick shortcut.
</li></ul>
Note: in Custom SQL Statement, do NOT do <pre>SELECT *</pre> it will be rejected by the injection protection of Dolibarr - and anyway this is totally useless as the module won't show you the result of the request, you should better try sql commands like View, Procedure, Trigger, Check, etc..
<p>any SQL request (not just one or two commands like above) will be issued AFTER the creation statement (not in the same statement, this is the main difference with the Custom SQL Definition field).
</p><p>Eg: you are creating a custom field named "syncedfield" in "llx_invoices" and you want that everytime data is inserted into that field, the same data is also inserted in another field named "remotefield" but in another table named "llx_propal". You can use a trigger that you will create at the same time as the field, with something like that:
</p>
<pre>CREATE TRIGGER synctrigger AFTER INSERT ON llx_invoices INSERT INTO llx_propal (remotefield) VALUES (NEW.syncedfield)</pre>
<p>In practice, when you create the custom field, it will then issue two different requests:
</p>
<pre>ALTER llx_invoices ADD syncedfield int(11);
CREATE TRIGGER synctrigger AFTER INSERT ON llx_invoices INSERT INTO llx_propal (remotefield) VALUES (NEW.syncedfield)
</pre>
<p>Notice the semicolon (;) at the end of the first request.
</p><p>The field Custom SQL Statement is just a shortcut to quickly input a SQL request to be issued just after the creation of the field, but of course you can do the same by using phpmyadmin or any other interface and issuing SQL requests by yourself.
</p><p>Note2: if what you want to do is to store metadata about your custom fields (extended infos), you do not necessarily have to use SQL, but you may use a relatively recent facility called ExtraOptions, which allow you to basically store any data you want about a custom field (NOT about each record, but about the custom field! Thus there is one ExtraOptions per custom field, not per record!).
More info can be found here: <a href="Module CustomFields - Dolibarr Wiki.html_Dev#CustomFields_JSON_API" title="Module CustomFields Dev">CustomFields JSON API</a>
</p>
<hr>
<p>At last, you can click on the <b>Save</b> button to create the field.
</p><p>As soon as the field is created, the page will reload and the field will show up in the list of custom fields, and also it will be immediately available in the module's datasheet page (you can go there and try it).
</p><p>Note: fields are ordered by ordinal_position (order of creation - first created at the top, last at the bottom), so if you want a specific order for your fields, you are advised to carefully think what order you want. Then delete and recreate fields in the order you want them to be.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=9" title="Edit section: Modifying a custom field">edit</a>]</span> <span class="mw-headline" id="Modifying_a_custom_field"> Modifying a custom field </span></h2>
<p>To edit a custom field, just click on the edit button at the right hand side of the admin page (one button per field).
</p><p>The same form as when you create a custom field will appear with the parameters of the field, and you can then freely edit them, and click <b>Save</b> to commit the changes.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=10" title="Edit section: Deleting a custom field">edit</a>]</span> <span class="mw-headline" id="Deleting_a_custom_field"> Deleting a custom field </span></h2>
<p>To delete a custom field, simply click on the trash button at the right hand side (just at the right of the edit button).
</p><p>WARNING: no confirmation will be asked, and once a custom field is deleted you can not get it back nor get back the values saved by user, they are lost forever! Anyway you can re-create the same field, but user's values will still be lost.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=11" title="Edit section: Translation of a custom field&#39;s label">edit</a>]</span> <span class="mw-headline" id="Translation_of_a_custom_field.27s_label"> Translation of a custom field's label </span></h2>
<p>Fields can easily be labeled or translated using the provided language files.
</p><p>Just edit /customfields/langs/code_CODE/customfields-user.lang (where code_CODE is the ISO code of your region, eg: en_US) and add inside the Variable name of your custom field (shown in the admin panel, column Variable) and the translation (format: cf_something= My Label).
</p><p>Eg: let's say your custom field is named "user_ref", the resulting variable will be "cf_user_ref". In the customfields-user.lang file just add:
</p>
<pre>cf_user_ref= The label you want. You can even write a very very very long sentence here.&lt;br /&gt;You can even do a line return with &lt;br /&gt;.
</pre>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=12" title="Edit section: Testing your custom fields with the PDFTest module">edit</a>]</span> <span class="mw-headline" id="Testing_your_custom_fields_with_the_PDFTest_module"> Testing your custom fields with the PDFTest module </span></h2>
<p>An auxiliary module called CustomFieldsPDFTest is provided so that you can easily test your custom fields in your PDF outputs. This avoids the need to make your own PDF template and risking to do some mistakes in the php code.
</p><p>Just enable the CustomFieldsPDFTest in Home&gt;Setup&gt;Modules and then generate a PDF document using any template.
</p><p>A page will be appended to the end of the generated PDF with an extensive list of all the available custom fields, their values and their raw values (raw value = no beautify, no html encode and no translation).
</p><p>You can then see if the custom fields fits your needs and contain all the informations you will need in your final PDF template. Disable it when finished, you will make your own PDF template after (see below).
</p><p>Note: already generated pdf files won't be affected, only generated PDF documents <b>after the PDFTest module is activated</b> will have a list of custom fields appended, and if you disable the module and generate again the PDF document, the appended page will disappear.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=13" title="Edit section: Implementing in ODT templates">edit</a>]</span> <span class="mw-headline" id="Implementing_in_ODT_templates"> Implementing in ODT templates </span></h2>
<p>First, you have to know how to create an ODT template. Please refer to the related documentation: <a href="http://wiki.dolibarr.org/index.php/Create_an_ODT_document_template" title="Create an ODT document template">Create_an_ODT_document_template</a>
</p><p>Custom fields are automatically loaded for ODT templates.
</p><p>Just use the shown variable name (<b>Variable</b> column in the configuration page) as a tag enclosed by two braces.
</p><p>Eg: for a customfield named user_ref, you will get the Variable name cf_user_ref. In your ODT, to get the value of the field, just type
</p>
<pre>{cf_user_ref}
</pre>
<p>You can also get the raw value (without any preprocessing) by appending _raw to the variable name:
</p>
<pre>{cf_user_ref_raw}
</pre>
<p>There is also full support for constrained fields, so that if you have a constraint on this field, it will automatically fetch all the linked values of the referenced tables and you will be able to use them with tags.
Eg: cf_user_ref is constrained on the <b>llx_user</b> table:
</p>
<pre>{cf_user_ref} = rowid
{cf_user_ref_firstname} = firstname
{cf_user_ref_user_mobile} = mobile phone
etc...
</pre>
<p>As you can see, you just need to append '_' and the name of the column you want to access to show the corresponding value.
</p><p>For lines, it works just the same, you just have to put the variable name inside the table that handles the product's lines, between the tags [!-- BEGIN row.lines --] and [!-- END row.lines --]
</p><p>Note: an interesting use of custom fields is to use a TrueFalseBox with a conditional substitution, eg: with a custom fields cf_enablethis:
</p>
<pre>[!-- IF {cf_enablethis_raw} --]
This is enabled and this will show.
[!-- ELSE {cf_enablethis_raw} --]
Else this will show up when disabled.
[!-- ENDIF {cf_enablethis_raw} --]
</pre>
<p>We need to use the raw value, because we need to have a 0/1 value for the conditional to work. It also works for empty/non-empty, so this can also work with empty Textbox or any other sql datatype: if there's no text, you can avoid to show anything:
</p>
<pre>[!-- IF {cf_mytextfield_raw} --]
My text field is not empty, here is its value: {cf_mytextfield}
[!-- ENDIF {cf_mytextfield_raw} --]
</pre>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=14" title="Edit section: Implementing in PDF templates">edit</a>]</span> <span class="mw-headline" id="Implementing_in_PDF_templates"> Implementing in PDF templates </span></h2>
<p>First, before implementing the custom fields, you have to make your own PDF template. Please refer to the related documentation: <a href="http://wiki.dolibarr.org/index.php/Create_a_PDF_document_template" title="Create a PDF document template">Create_a_PDF_document_template</a>
</p><p>To use custom fields in your PDF template, you first need to load the custom fields datas, then you can use them wherever you want.
</p>
<ul><li> To load the custom fields:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="co1">// Init and main vars for CustomFields</span>
dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/lib/customfields_aux.lib.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Filling the $object with customfields (you can then access customfields by doing $object-&gt;customfields-&gt;cf_yourfield)</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">customfields</span> <span class="sy0">=</span> customfields_fill_object<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$outputlangs</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// beautified values</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">customfields_raw</span> <span class="sy0">=</span> customfields_fill_object<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$outputlangs</span><span class="sy0">,</span> <span class="st_h">'raw'</span><span class="sy0">,</span> <span class="kw4">null</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// raw values</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">customfields_lines</span> <span class="sy0">=</span> customfields_fill_object_lines<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$outputlangs</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// product lines' values</span></pre></div></div>
<p>Note: you can place this just after:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$pdf</span><span class="sy0">=</span>pdf_getInstance<span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">format</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<ul><li> To access the field's value:
</li></ul>
<p>Beautified formatting:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span></pre></div></div>
<p>or for the raw value:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">raw</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span></pre></div></div>
<ul><li> To access a product's line's value:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$lineid</span> <span class="sy0">=</span> <span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">lines</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span><span class="sy0">-&gt;</span><span class="me1">rowid</span><span class="sy0">;</span>
<span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">lines</span><span class="sy0">-&gt;</span><span class="re0">$lineid</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span></pre></div></div>
<p>Where $lineid must be replaced by the id of the line you want to fetch (rowid of the product, so it does NOT necessary start at 0).
</p>
<ul><li> To print it with FPDF (the default PDF generation library):
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">MultiCell</span><span class="br0">(</span>0<span class="sy0">,</span>3<span class="sy0">,</span> <span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'L'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// printing the customfield</span></pre></div></div>
<ul><li> And if you want to print the multilanguage label of this field&nbsp;:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$outputlangs</span><span class="sy0">-&gt;</span><span class="me1">load</span><span class="br0">(</span><span class="st_h">'customfields-user@customfields'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$mylabel</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">findLabel</span><span class="br0">(</span><span class="st0">"cf_myfield"</span><span class="sy0">,</span> <span class="re0">$outputlangs</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where $outputlangs is the language the PDF should be outputted to</span></pre></div></div>
<p>or if you want to do it automatically (useful for a loop):
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$outputlangs</span><span class="sy0">-&gt;</span><span class="me1">load</span><span class="br0">(</span><span class="st_h">'customfields-user@customfields'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$keys</span><span class="sy0">=</span><span class="kw3">array_keys</span><span class="br0">(</span><span class="kw3">get_object_vars</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$mylabel</span> <span class="sy0">=</span> <span class="re0">$outputlangs</span><span class="sy0">-&gt;</span><span class="me1">trans</span><span class="br0">(</span><span class="re0">$keys</span><span class="br0">[</span>xxx<span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where xxx is a number, you can iterate foreach($keys as $key) if you prefer</span></pre></div></div>
<ul><li> If you want to print an HTML field (Areabox), the FPDF library provides you with a mean to do so:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">writeHTML</span><span class="br0">(</span><span class="st_h">'HTML beautified printing for myfield: '</span><span class="sy0">.</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// printing areabox with html parsing</span>
<span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">writeHTMLCell</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// you can also use writeHTMLCell() to get more options with the positionning of your cell</span></pre></div></div>
<p>Warning: TCPDF support for HTML is very limited and not guaranteed. If you use the writeHTML() method and it doesn't print you any text of the field in your PDF, then try to strip out the html tags by doing something like this:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$myfield</span> <span class="sy0">=</span> <span class="kw3">str_replace</span><span class="br0">(</span><span class="kw3">array</span><span class="br0">(</span><span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>"</span><span class="sy0">,</span><span class="st0">"<span class="es1">\r</span><span class="es1">\n</span><span class="es1">\r</span><span class="es1">\n</span>"</span><span class="br0">)</span><span class="sy0">,</span> <span class="st0">"<span class="es1">\n</span>"</span><span class="sy0">,</span><span class="kw3">strip_tags</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">MultiCell</span><span class="br0">(</span>0<span class="sy0">,</span>3<span class="sy0">,</span> <span class="re0">$myfield</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'L'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// printing the customfield with line returns but no HTML</span></pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=15" title="Edit section: Implementing in php code (dolibarr core modules or your own module)">edit</a>]</span> <span class="mw-headline" id="Implementing_in_php_code_.28dolibarr_core_modules_or_your_own_module.29"> Implementing in php code (dolibarr core modules or your own module) </span></h2>
<p>One of the main features of the CustomFields module is that it offers a generic way to access, add, edit and view custom fields from your own code. You can easily develop your own modules accepting user's inputs based on CustomFields.
</p><p>You can use a simplifier library that eases a lot the usage of custom fields in php codes:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1">dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/lib/customfields_aux.lib.php'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// include the simplifier library</span>
<span class="re0">$customfields</span> <span class="sy0">=</span> customfields_fill_object<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$langs</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// load the custom fields values inside $object-&gt;customfields</span></pre></div></div>
<p>customfields_fill_object() takes 5 parameters:
</p>
<ul><li> $object: the object where the custom fields datas will be set
</li><li> $fromobject: the object from which the custom fields will be fetched (this can be used to fetch custom fields from multiple modules into one $object)
</li><li> $langs: language translation class, to localize your custom fields values
</li><li> $prefix: prefix to add to help you organize and avoid overwriting custom fields (eg: you have two modules and want to store into one $object, with $prefix='invoice' the first will store inside $object-&gt;customfields-&gt;invoice-&gt;cf_myfield, and second='propal' will store inside $object-&gt;customfields-&gt;propal-&gt;cf_myfield).
</li><li> $pdfformat: beautify the customfields values? (null = no beautify nor translation; false = beautify and translate; true = translation and pdf beautify with html entities encoding)
</li></ul>
<p>Note: $fromobject (or $object if $fromobject=null) can be a dummy object and contain only two properties: $fromobject-&gt;id and $fromobject-&gt;table_element (which is the module's name, or table's name where the module stores its datas).
</p><p>You can then access easily to the custom fields values:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>To load product's lines custom fields, you can use the customfields_fill_object_line() function which takes exactly the same parameters:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1">dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/lib/customfields_aux.lib.php'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// include the simplifier library</span>
<span class="re0">$customfields</span> <span class="sy0">=</span> customfields_fill_object_lines<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$langs</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// load the custom fields values inside $object-&gt;customfields</span></pre></div></div>
<p>Then you can access the line's custom fields by using:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">lines</span><span class="sy0">-&gt;</span><span class="re0">$lineid</span><span class="sy0">-&gt;</span><span class="me1">cf_myfield</span></pre></div></div>
<p>You can also manually fetch the custom fields values (called $records below):
</p>
<ul><li> First, you necessarily have to instanciate the CustomFields class:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="co1">// Init and main vars</span>
<span class="co1">//include_once(DOL_DOCUMENT_ROOT.'/customfields/class/customfields.class.php'); // OLD WAY</span>
dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/class/customfields.class.php'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// NEW WAY since Dolibarr v3.3</span>
<span class="re0">$customfields</span> <span class="sy0">=</span> <span class="kw2">new</span> CustomFields<span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">db</span><span class="sy0">,</span> <span class="re0">$currentmodule</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where $currentmodule is the current module, you can replace it by '' if you just want to use printing functions and fetchAny.</span></pre></div></div>
<ul><li> Secondly, you have the fetch the records (this will fetch ALL custom fields for ALL records):
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$records</span> <span class="sy0">=</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">fetchAll</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<ul><li> Thirdly, you can now print all your records this way:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="kw3">is_null</span><span class="br0">(</span><span class="re0">$records</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// verify that we have at least one result</span>
  <span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$records</span> <span class="kw1">as</span> <span class="re0">$record</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// in our list of records we walk each record</span>
    <span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$record</span> <span class="kw1">as</span> <span class="re0">$label</span> <span class="sy0">=&gt;</span> <span class="re0">$value</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// for each record, we extract the label and the value</span>
      <span class="kw1">print</span> <span class="re0">$label</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$value</span><span class="sy0">;</span> <span class="co1">// Simple printing, with no beautify nor multilingual support</span>
      <span class="kw1">print</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">findLabel</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">varprefix</span><span class="sy0">.</span><span class="re0">$label</span><span class="br0">)</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">simpleprintField</span><span class="br0">(</span><span class="re0">$label</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Full printing method with multilingual and beautified printing of the values. Note: We need to add the varprefix for the label to be found.  For printField, we need to provide the meta-informations of the current field to print the value from, depending on these meta-informations the function will choose the right presentation.</span>
    <span class="br0">}</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<ul><li> Full final code:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="co1">// Init and main vars</span>
<span class="co1">//include_once(DOL_DOCUMENT_ROOT.'/customfields/class/customfields.class.php'); // OLD WAY</span>
dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/class/customfields.class.php'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// NEW WAY since Dolibarr v3.3</span>
<span class="re0">$customfields</span> <span class="sy0">=</span> <span class="kw2">new</span> CustomFields<span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">db</span><span class="sy0">,</span> <span class="re0">$currentmodule</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where $currentmodule is the current module, you can replace it by '' if you just want to use printing functions and fetchAny.</span>
<span class="co1">// Fetch all records</span>
<span class="re0">$records</span> <span class="sy0">=</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">fetchAll</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// Walk and print the records</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="kw3">is_null</span><span class="br0">(</span><span class="re0">$records</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// verify that we have at least one result</span>
  <span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$records</span> <span class="kw1">as</span> <span class="re0">$record</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// in our list of records we walk each record</span>
    <span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$record</span> <span class="kw1">as</span> <span class="re0">$label</span> <span class="sy0">=&gt;</span> <span class="re0">$value</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// for each record, we extract the label and the value</span>
      <span class="kw1">print</span> <span class="re0">$label</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$value</span><span class="sy0">;</span> <span class="co1">// Simple printing, with no beautify nor multilingual support</span>
      <span class="kw1">print</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">findLabel</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">varprefix</span><span class="sy0">.</span><span class="re0">$label</span><span class="br0">)</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">simpleprintField</span><span class="br0">(</span><span class="re0">$label</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Full printing method with multilingual and beautified printing of the values. Note: We need to add the varprefix for the label to be found.  For printField, we need to provide the meta-informations of the current field to print the value from, depending on these meta-informations the function will choose the right presentation.</span>
    <span class="br0">}</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<ul><li> If you want to fetch only one record:
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$record</span> <span class="sy0">=</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">fetch</span><span class="br0">(</span><span class="re0">$id</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Where id is of course the id of the record to fetch.</span>
&nbsp;
<span class="kw1">foreach</span> <span class="br0">(</span><span class="re0">$record</span> <span class="kw1">as</span> <span class="re0">$label</span> <span class="sy0">=&gt;</span> <span class="re0">$value</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// for each record, we extract the label and the value</span>
  <span class="kw1">print</span> <span class="re0">$label</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$value</span><span class="sy0">;</span> <span class="co1">// Simple printing, with no beautify nor multilingual support</span>
  <span class="kw1">print</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">findLabel</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">varprefix</span><span class="sy0">.</span><span class="re0">$label</span><span class="br0">)</span><span class="sy0">.</span><span class="st_h">' has value: '</span><span class="sy0">.</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">simpleprintField</span><span class="br0">(</span><span class="re0">$label</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Full printing method with multilingual and beautified printing of the values. Note: We need to add the varprefix for the label to be found.  For printField, we need to provide the meta-informations of the current field to print the value from, depending on these meta-informations the function will choose the right presentation.</span>
<span class="br0">}</span></pre></div></div>
<ul><li> You can get the errors returned by the CustomFields class (sql errors and others):
</li></ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw1">print</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">error</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// This will print all errors concatenated in a single string returned by the CustomFields class</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">errors</span><span class="br0">[</span>0<span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// To print a specific error separately from the rest (can be useful to better understand what happened)</span>
&nbsp;
<span class="co1">// More complete example:</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="kw3">empty</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">error</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
  dol_htmloutput_errors<span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">error</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Use the old Dolibarr error printing facility</span>
  setEventMessage<span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">error</span><span class="sy0">,</span> <span class="st_h">'errors'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Use the new Dolibarr 3.3 error printing facility</span>
<span class="br0">}</span></pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=16" title="Edit section: Do&#39;s and don&#39;t to avoid slowdowns when implementing CustomFields">edit</a>]</span> <span class="mw-headline" id="Do.27s_and_don.27t_to_avoid_slowdowns_when_implementing_CustomFields"> Do's and don't to avoid slowdowns when implementing CustomFields </span></h2>
<ul><li> In PDF templates, use customfields_fill_object_lines() only ONCE before the loop, else it will be very heavy on CPU and memory usage (using it once will already fetch all lines for the current object at once, no need to use it several times).
</li></ul>
<ul><li> Adding a lot of customfields or product lines won't really slow down CustomFields in any way (datasheet printing, editing field, PDF/ODT generation, etc..), thank's to caching.
</li></ul>
<ul><li> Try to avoid the number of constrained customfields: adding a lot of constrained customfields will, because CustomFields automatically lookup the remote tables for every constrained field, so that you can access any remote column in your PDF. There is a cache mechanism that tries to speed up the process, so for example if you have many different constrained customfields on the same remote table (eg: with different Smart Value Substitution prefixes), then the performance won't be tampered, but if every constrained customfields is linked to a different table, there is no way around, it will slow down. If you encounter problems, try to limit the number of constrained fields you create, or try to add SQL indexes on the remote table of the constrained field, or don't use customfields_fill_object*() functions but directly access _only_ the fields you need by using the CustomFields class or your own sql query.
</li></ul>
<ul><li> Smart value substitution for constrained fields does not hamper any performance (eg: prefix of the remote column for auto replacement of the raw value by the specified column's value).
</li></ul>
<ul><li> Try to use customfields_fill_object() and customfields_fill_object_lines() only once per script, these functions are really heavy and do all the work for you, they are optimized and cache everything they can, but the drawback is that they're heavy. An easy way is to modify directly the original $object, so that the result will be transmitted to every other parts of Dolibarr (but be careful, do it only if you know that this will not conflict). You can also choose to not use these functions at all, and use directly the CustomFields class, if you have really specific needs, you can have fastest results (eg: if you don't need to fetch all the customfields but only one or a few, or if you only need the raw values).
</li></ul>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=17" title="Edit section: Constraints">edit</a>]</span> <span class="mw-headline" id="Constraints"> Constraints </span></h1>
<p>This chapter will present the special functionnalities of constrained fields, which are a powerful functionnality of CustomFields.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=18" title="Edit section: Adding a constrained/linked custom field">edit</a>]</span> <span class="mw-headline" id="Adding_a_constrained.2Flinked_custom_field"> Adding a constrained/linked custom field </span></h2>
<p>Let's say you want to make a custom field that let you choose among all the users of Dolibarr.
</p><p>With CustomFields, that's very easy: at the customfield creation, just select the table you want to link in Constraints.
</p><p>In our example, you'd just have to select "llx_users", and click Create button.
</p><p>All the rest is done for you, everything is managed automatically.
</p><p>PowerTip1: What is great is that you are not limited to Dolibarr's tables: if a third-party module or even another software share this same database as Dolibarr, you can select their tables as well and everything will be managed the same way.
</p><p>PowerTip2: If that's still not enough to satisfy your needs, you can create more complex sql fields by using the Custom SQL field at the creation or update page, the sql statement that you will put there will be executed just after the creation/update of the field, so that you can create view, execute procedures. And the custom field will still be fully managed by CustomFields core without any edit to the core code.
</p><p>PowerTip3: And if that's still not enough, you can <a href="Module CustomFields - Dolibarr Wiki.html#Overloading_functions:_Adding_your_own_management_code_for_custom_fields" title="Module CustomFields">overload functions</a> to manage your fields directly with the customfields_fields_extend.lib.php library. And yes, it also works with constrained fields.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=19" title="Edit section: Smart Value Substitution">edit</a>]</span> <span class="mw-headline" id="Smart_Value_Substitution"> Smart Value Substitution </span></h2>
<p>Smart Value Substitution is a quick and easy option to show another remote field's value of a constrained field in place of the raw value (sql row id).
</p><p>If you want your constrained field to show another value than the rowid, just set your custom field's name to the name of the remote field you want to show.
</p><p>Eg: let's say you want to show the name of the users in the <b>llx_users</b> table, not the rowid.
Just create a custom field with field name = "name" (without quotes) and it will automatically show the name fields instead of the rowid. And don't forget, in the PDF and ODT, you can access all the remote fields, not only name, but firstname, phone number, email, etc..
</p><p>Also, you can specify to use not just one remote field but several, by concatenating the name of all the remote fields you want to show separated by underscores.
</p><p>eg: Create a custom field named "name_firstname_login" constrained on <b>llx_users</b> will show values formatted like 'Admin John admin'. Every value is separated by a space.
</p><p>This can be particularly powerful if you want to show a list of choice with sublists.
</p><p>eg: let's say that llx_country_regions contains a list of countries and regions, like
</p>
<pre>country region
--------------
France  Paris
France  Seine-Saint-Denis
Canada  Quebec
</pre>
<p>And you want the user to choose not only the country but also the region, you can just create a custom fields with the name 'country_region' and it will show a list of all countries and regions, from which the user will easily choose.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=20" title="Edit section: Remote Fields Access via a constrained field">edit</a>]</span> <span class="mw-headline" id="Remote_Fields_Access_via_a_constrained_field"> Remote Fields Access via a constrained field </span></h2>
<p>With constrained fields, you can not only access the custom field's value, but also any remote field (sql column) of the linked table.
</p><p><b>This feature works on any constrained field</b>, just create a custom field with a constraint on a table, and you can use this feature.
</p><p>To access any remote field, just append "_remotecolumn" to the <b>variable</b> name of the custom field (eg: cf_myfield_remotecolumn).
</p><p>For example, if you create a custom field "firstname_name" constrained on <b>llx_users</b>, you can access any other field of llx_users.
</p><p>In ODT:
</p>
<pre>{cf_firstname_name} will print something like John Doe
{cf_firstname_name_login} will print john
{cf_firstname_name_email} will print johndoe@somemail.com
{cf_firstname_name_user_mobile} will print 0123456789
{cf_firstname_name_firstname} will print John
{cf_firstname_name_name} will print Doe
</pre>
<p>In PDF or PHP code:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="co1">// Init and main vars for CustomFields</span>
dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/lib/customfields_aux.lib.php'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Filling the $object with customfields (you can then access customfields by doing $object-&gt;customfields-&gt;cf_yourfield)</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">customfields</span> <span class="sy0">=</span> customfields_fill_object<span class="br0">(</span><span class="re0">$object</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$outputlangs</span><span class="sy0">,</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// beautified values</span>
&nbsp;
<span class="co1">// Printing</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will John Doe</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_login</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will john</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_email</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will johndoe@somemail.com</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_user_mobile</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will 0123456789</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_firstname</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will John</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_name</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// will Doe</span>
&nbsp;
<span class="co1">// PDF printing</span>
<span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">MultiCell</span><span class="br0">(</span>0<span class="sy0">,</span>3<span class="sy0">,</span> <span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'L'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">MultiCell</span><span class="br0">(</span>0<span class="sy0">,</span>3<span class="sy0">,</span> <span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_login</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'L'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$pdf</span><span class="sy0">-&gt;</span><span class="me1">MultiCell</span><span class="br0">(</span>0<span class="sy0">,</span>3<span class="sy0">,</span> <span class="re0">$object</span><span class="sy0">-&gt;</span><span class="me1">customfields</span><span class="sy0">-&gt;</span><span class="me1">cf_firstname_name_email</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'L'</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>PowerTip: to get the list of available variable, you can use the CustomFieldsPDFTest module (provided with CustomFields Pro) to print the full list of custom fields variables for you. This list will be printed in a PDF, but the variables' names are the same in ODT document.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=21" title="Edit section: Recursive Remote Fields Access via a constrained field">edit</a>]</span> <span class="mw-headline" id="Recursive_Remote_Fields_Access_via_a_constrained_field"> Recursive Remote Fields Access via a constrained field </span></h2>
<p>In ODT and PDF documents and when using the customfields_fill_object() api, you automatically get a very powerful feature: the recursive access to remote fields.
</p><p>This is just like Remote Fields Access, but recursively: if the remote table contains constrained custom fields, these remote constrained custom fields will also be traversed and the referenced table they link to will be fetched too.
</p><p>This will be clearer with an example: let's say you have a custom field named "user_firstname" in the Client Invoice module, that is constrained on "llx_user". Now, let's say that on the User module, you also added a custom field named "task_name", constrained on "llx_project_task". Now, in your invoices, when you select a user in the "user_firstname" custom field, you will not only get every standard User fields associated to the selected user, but also the task selected for this user and every fields of the linked Task object for this user. Thus, you here linked an invoice to a user to a task, without even programming anything!
</p><p>This is a very powerful feature, somewhat similar to ProductsEasyAccess but more generic (and thus less efficient). Indeed, be aware that this powerful feature has a drawback: it can consume a lot of resources and thus slowndown significantly your PDF/ODT generation process. However, this should not slowdown your navigation in your Dolibarr webapp, since the recursive remote fields access is only enabled on PDF/ODT generation or in your code using customfields_fill_object() (because CustomFields does not use this facade API internally).
</p><p>Additionally, there is nothing to enable, this functionality is managed automatically. You just need to create constrained fields to make the bridge between the different modules you want to access.
</p><p>Powertip: you can mix this automatic feature with the NonEditable option, the Hide option and the Duplication option: this will allow you to make a bridge and access any object. For example, in your Invoices, if you want to access in your ODT document every fields of the Client (most of the client's infos are not accessible in ODT documents), you can create a custom field that will duplicate the client's id field, and then in your ODT document you will gain access to any Client's fields thank's to the RRFA feature. If in addition you put this custom field as NonEditable and Hide, this custom field will be totally transparent and hidden, your Dolibarr users won't even notice it.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=22" title="Edit section: Manage constrained fields programmatically">edit</a>]</span> <span class="mw-headline" id="Manage_constrained_fields_programmatically"> Manage constrained fields programmatically </span></h2>
<p>If you use the facade API customfields_fill_object(), the constrained fields will be automatically managed for you, you won't have to do any further processing.
</p><p>However, if you want to have a finer control over constrained fields, read the rest of this chapter.
</p><p>Constrained custom fields are just like any custom field: you can $customfields-&gt;fetch() it, and also $customfields-&gt;fetchFieldStruct() to get its options.
</p><p>Example to load the constrained custom field structure and check if it's really constrained:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1">dol_include_once<span class="br0">(</span><span class="st_h">'/customfields/class/customfields.class.php'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// NEW WAY since Dolibarr v3.3</span>
<span class="re0">$customfields</span> <span class="sy0">=</span> <span class="kw2">new</span> CustomFields<span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">db</span><span class="sy0">,</span> <span class="re0">$currentmodule</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where $currentmodule is the current module, you can replace it by '' if you just want to use printing functions and fetchAny.</span>
<span class="re0">$myfield</span> <span class="sy0">=</span> <span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">fetchFieldStruct</span><span class="br0">(</span><span class="st_h">'myfield'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// where 'myfield' is the name of the constrained custom field</span>
&nbsp;
<span class="co1">// Check if it's a constrained field</span>
<span class="kw1">if</span> <span class="br0">(</span><span class="re0">$myfield</span><span class="sy0">-&gt;</span><span class="me1">referenced_table_name</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="co1">// Do your stuff here...</span>
<span class="br0">}</span></pre></div></div>
<p>Now, if you want to fetch the remote fields referenced by your constrained customfield, use one of the following:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="co1">//$fkrecord = $customfields-&gt;fetchAny('*', $field-&gt;referenced_table_name, $field-&gt;referenced_column_name."='".$id."'"); // we fetch the record in the referenced table. Equivalent to the fetchReferencedValuesList command below using $id=$value and $allcolumns=true.</span>
<span class="co1">//$fkrecord = $customfields-&gt;fetchReferencedValuesList($field, $id, null, true); // works correctly but is not recursive. Use fetchReferencedValuesRec() for a recursive fetching.</span>
<span class="re0">$fkrecord</span> <span class="sy0">=</span> fetchReferencedValuesRec<span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="re0">$field</span><span class="sy0">,</span> <span class="re0">$id</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// we fetch the record in the referenced table, in a recursive fashion.</span></pre></div></div>
<p>where $id is the id of the record you want to fetch, generally given by $object-&gt;cf_myfield.
</p><p>For more info on these functions, see the developper's documentation.
</p><p>From here, you have an $fkrecord array containing all remote fields values, and you can do whatever you want with those.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=23" title="Edit section: Extra options">edit</a>]</span> <span class="mw-headline" id="Extra_options"> Extra options </span></h1>
<p>This chapter will present extra options that you can set in the administration panel.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=24" title="Edit section: Recopy">edit</a>]</span> <span class="mw-headline" id="Recopy"> Recopy </span></h2>
<p>Recopy option allows to transfert a custom field's value in module A to another custom field of another module B. This allows to keep custom fields values when converting an object.
</p><p>For example, let's say that you have a custom field named "piece_reference" in your Commercial proposals. You now would like that when you convert your Commercial proposals into an Invoice, you also transfert this "piece_reference" in the Invoice so that you can easily print it on your generated invoice documents. To do this, you just need to create a custom field named the same, "piece_reference", on Invoices, and then enable the Recopy option on it (not on Commercial proposal's custom field, the recopy option is to be enabled on the child field on which we want to recopy on).
</p><p>This feature is automatically managed, and it supports chaining (eg: recopy from Intervention to Commercial Proposal, and then recopy from Commercial Proposal to Invoice).
</p><p>You can also specify the parent field's name if the name is different (eg: "piece_reference" in Commercial proposals but "client_ref" in Invoices).
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=25" title="Edit section: Cascade">edit</a>]</span> <span class="mw-headline" id="Cascade"> Cascade </span></h2>
<p>This option allows to create dynamically linked/dependent lists, also called <b>cascaded dropdown lists</b>.
</p><p>This is a common construct seen on the modern web, for example: you want to be able to specify the location of your client. To do this, instead of using a text field to enter the address, you'd prefer to use Dropdown lists as to avoid entry mistakes. To do that, you can create one field "country_libelle" (or country_label in Dolibarr &gt;= 3.7) constrained on llx_c_pays to indicate the client's country, and then another field "region_nom" constrained on llx_c_regions to show the list of regions. However, those two lists are independent, and the selected region can be entirely wrong considered the country. To limit the available regions depending on the selected country, you can use the Cascade option on the "region_nom" (child) field, and set the Parent field to be "country_libelle". Then, you will see that regions will automatically be limited to the relevant ones depending on the selected country. This is called <b>cascading</b>, because the parent field "country_libelle" cascaded its value to the child "region_nom".
</p><p>By default, the management of the cascade is fully automatic and is managed via AJAX. For compatibility, if the user has no AJAX support, the cascading won't happen so that user's without AJAX support (eg: smartphones, tablets, etc.) will still be able to select a value.
</p><p>Currently, the automatic management only works on <b>constrained fields</b> (both the child and parent fields must be constrained). If you want to cascade fields of other types than Constrained, you can use the <a href="Module CustomFields - Dolibarr Wiki.html#Custom_AJAX_Functions" title="Module CustomFields">Custom Ajax Functions</a> facility (see below) to manage cascading at object's creation, and <a href="Module CustomFields - Dolibarr Wiki.html#Overloading_functions:_Adding_your_own_management_code_for_custom_fields" title="Module CustomFields">Overloading Functions</a> to manage cascading at object's edition.
</p><p>To setup a cascade in the administration panel, you just need to enable the Cascade option, and select the Parent field that should cascade its value onto the currently edited field. The admin panel will try to fill out the remaining fields automatically. However, if an alert is shown or if the two Join From and Join On fields remain empty, you will need to fill them manually.
</p><p>These two Join fields specify how the linked tables of the two constrained fields are related (eg: foreign key). CustomFields admin panel will try to detect that automatically, but this may not always be possible (if there's no foreign key).
</p>
<ul><li> Join From is the current field's linked table SQL column that points to the parent field's linked table.
</li><li> Join On is the parent field's linked table SQL column that is pointed by the Join From column (by default: rowid).
</li></ul>
<p>For example: let's say you now want to add a field to specify the department. To do that, you can create a field "dep_nom" constrained on llx_c_departements, and enable Cascade with the Parent field being "region_nom". However, CustomFields will show you an alert telling you that no relationship could be found. This is because the relationship between the two tables isn't encoded in a Foreign Key in your SQL database. To find the relationship, you can take a look using phpMyAdmin at both llx_c_departements and llx_c_regions tables, and you will see that llx_c_departements has a field named "fk_region" (so yes they are both linked), and llx_c_regions has a field named "code_region". You now have everything you need: set Join From as "fk_region", and set Join On as "code_region". Save your new custom field, and you will see that your "dep_nom" field is correctly cascaded when you select a region using "region_nom" field.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=26" title="Edit section: Duplicate">edit</a>]</span> <span class="mw-headline" id="Duplicate"> Duplicate </span></h2>
<p>Duplicate is a semi-automatic functionality that allows you to tell your custom field to automatically copy the value from another object's field. This is not to be confused with the Recopy or Clone options: Duplicate will copy a field from the same object, whereas Recopy copies the value from another object from a different type, and Clone copies from another object of the same type as the target one.
</p><p>Duplicate can copy from another custom field or from a standard Dolibarr's field.
</p><p>This is a very useful option in certain cases, for example when you want to gain access of standard Dolibarr's fields as tags in your ODT documents: in this case, you can simply set a hidden and noneditable custom field to duplicate this standard Dolibarr field you want to access, and it will be accessible in your ODT document, as simple as that.
</p><p>For example, let's say that in your Invoices ODT documents you want to access every fields of the Client (most of the client's infos are not accessible in ODT documents), you can create a custom field that will duplicate the client's id field, and then in your ODT document you will gain access to any Client's fields thank's to the RRFA feature. If in addition you put this custom field as NonEditable and Hide, this custom field will be totally transparent and hidden, your Dolibarr users won't even notice it.
</p><p>To enable this option, you just need to fill the DuplicateFrom field: this is the name of the property in $object that you want to copy. $object is the standard thing in Dolibarr that contains everything about your invoice, client, propal, etc. You can set any property, or even convoluted paths.
</p><p>For example, you can set DuplicateFrom="mycustomfield". In this case, if you have another custom field named "mycustomfield", this field will be automatically duplicated in this one (by accessing $object-&gt;cf_mycustomfield).
</p><p>Now, let's say you set DuplicateFrom="client-&gt;id". Here, you will access $object-&gt;client-&gt;id, which is the identifier number of the client for the current invoice. In the end, your custom field will duplicate the client id. If in addition you set the custom field to be constrained on "llx_user", you will get a full access to all of the client's fields, and even client's custom fields.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=27" title="Edit section: Other options">edit</a>]</span> <span class="mw-headline" id="Other_options"> Other options </span></h2>
<p>Here are a few other options that you can set:
</p>
<ul><li> Required: make the field required at object's creation. Eg: when creating an Invoice, this field will need to be filled, empty value will not be accepted.
</li></ul>
<ul><li> Not editable: the field cannot be edited by users. Particularly useful for summary fields (eg: an Invoice Lines's custom field that does the final sum after applying custom coefficients on the product's price). These fields are to be implemented by yourself via <a href="Module CustomFields - Dolibarr Wiki.html#Overloading_functions:_Adding_your_own_management_code_for_custom_fields" title="Module CustomFields">overloading functions</a> (you will get every infos you need, other fields included, you'll just have to make your computations and then return that).
</li></ul>
<ul><li> Hide: hide this custom field from view. It can still be seen in sourcecode and be manipulated via overloading functions and custom ajax functions. This is particularly useful if you want to hide/show some fields conditionally to the value selected on another field (to do that, enable Cascade and Hide on this field, and then use a custom ajax function (see below) to trigger display depending on parent's value).
</li></ul>
<ul><li> Separator: display a separator above the current field, thus all fields below the current one (included) will be shown in a separate table.
</li></ul>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=28" title="Edit section: Advanced configuration">edit</a>]</span> <span class="mw-headline" id="Advanced_configuration"> Advanced configuration </span></h1>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=29" title="Edit section: Changing the default variable prefix for fields name">edit</a>]</span> <span class="mw-headline" id="Changing_the_default_variable_prefix_for_fields_name"> Changing the default variable prefix for fields name </span></h2>
<p>A prefix is automatically added to each custom field's name in the code (not in the database!), to avoid any collision with other core variables or fields in the Dolibarr core code.
</p><p>By default, the prefix is "cf_", so if you have a custom field named "user_ref" you will get "cf_user_ref".
</p><p>This behaviour can easily be changed by editing the general configuration file for CustomFields located inside /htdocs/customfields/conf/conf_customfields.lib.php.
</p><p>Then edit the value of the <b>$fieldsprefix</b> variable.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=30" title="Edit section: Changing the delimiter for Smart Value Substitution">edit</a>]</span> <span class="mw-headline" id="Changing_the_delimiter_for_Smart_Value_Substitution"> Changing the delimiter for Smart Value Substitution </span></h2>
<p>When using smart value substitution (ie: when you create a constrained field and set remote columns names in the field's name), by default every column name must be separated by an underscore '_'. This is usually good enough for most cases, but in a few occasions you might want to link to a remote column which name already contains an underscore, and in this case you won't be able to access it with SVS (but you can still access it with the remote field access in PDF/ODT templates and PHP codes, eg: myfield_remote_field_name_with_underscore).
</p><p>If you want to change the default delimiter, you can easily do so by editing the general configuration file for CustomFields located inside /htdocs/customfields/conf/conf_customfields.lib.php
</p><p>Then edit the value of the <b>$svsdelimiter</b> variable to any value you want.
</p><p>Note: You can set single characters as well as multiple characters for the svsdelimiter. Eg: $svsdelimiter='__'; will allow you to make a constrained field myfield__firstname__name on llx_users and linked to both the firstname and name columns from the llx_users table.
</p><p><b>CAUTION</b>: you can only set as a delimiter a character that is accepted by your DBMS, or else this will produce errors!
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=31" title="Edit section: Overloading functions: Adding your own management code for custom fields">edit</a>]</span> <span class="mw-headline" id="Overloading_functions:_Adding_your_own_management_code_for_custom_fields"> Overloading functions: Adding your own management code for custom fields </span></h2>
<p>The module offers an overloading facility where you can overload (read here: replace) functions of CustomFields by your own.
</p><p>The idea is that for each custom field you create, a few overloading functions are created and associated with it. You can use them or not. If you use them, you can put inside the functions your own SQL queries and other calculations you want to do, and then CustomFields will try to automatically manage this field, <b>using your specifications</b>.
</p><p>This can be used in various ways: to change how a particular field is printed, how a particular field is saved, to add your own SQL request to manage a custom field, to manage which options are shown to users, etc.
</p><p>Within this library, you can define one function per action (view, edit, create, save, etc.), per module and per field (so that you can define different functions for different fields).
</p><p>To overload CustomFields's functions, first rename the following file:
/customfields/fields/customfields_fields_extend.lib.php.example
</p><p>Into (just remove the .example at the end):
/customfields/fields/customfields_fields_extend.lib.php
</p><p>Then open it with your text/php editor.
</p><p>You will find inside all the information you need, here is an excerpt:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="coMULTI">/* Description: here you can overload a few functions of CustomFields to do your own stuff, mainly the printing and the management of the fields.
 *
 * Guidelines:
 * You can use and modify any variable, CustomFields will then use them afterwards (except for 'full' functions which completely overload CustomFields, so that you must take care of everything on your own).
 *
 * To access the database using Dolibarr's core functions, you can use:
 * global $db;
 * then you can: $db-&gt;query('SELECT * FROM table');
 *
 * You also can use CustomFields functions:
 * $customfields-&gt;fetchAny('*', 'table');
 * which is the equivalent of the command above.
 *
 * You can also access a variety of other things via globals, like:
 * $conf - contain all Dolibarr's config
 * $user - current user's loggued (can access his rights to check security)
 * $langs - current language of the user (for internationalization)
 *
 * Lastly, you can access all GET and POST variables using:
 * $myvar = GETPOST('myvar');
 *
 * Usage:
 * Simply put, almost all functions are procedures: you don't have to return anything, just modify the variables you want, and then CustomFields will continue where it left.
 * Exceptions are the 'full' functions (there's a 'full' in the name): these functions will stop CustomFields from processing the rest, and you have to do the rest, namely printing (because CustomFields won't print anything if you use 'full' functions, it just stops and leave you with the keys of the house).
 *
 * There are for the moment 8 possible overloading 'event' functions:
 * editview: in datasheet, when editing a customfield, you can modify the value and any other variable, and then CustomFields will continue the processing and will try to manage the best it can (mainly by showing a proper HTML form with inputs and buttons, and the right html input for the right type of data).
 * editviewfull: in datasheet, CustomFields stops processing and you do the rest (you then have to properly print an HTML form).
 * view: in datasheet, when just printing a customfield on the datasheet, you can modify the values and then CustomFields will continue the processing and printing of the form.
 * viewfull: in datasheet, when printing a customfield on the datasheet, CF stops and you do the rest of the printing (pretty simple, it's mainly just text or HTML).
 * create: in creation page, you can change the value(s) that will be available in a customfield, and then CustomFields will continue the processing/printing.
 * createfull: in creation page, CF stops and you do the rest of the processing/printing.
 * save: just before saving a custom field in database, you can change the values that will be stored in the database, and then CF will commit them (you don't have to, just change the values).
 * savefull: just before saving a custom field in database, CF stops the processing and you do the rest of the commit to the database (WARNING: CF will not store the data, you have to do it!).
 * aftersave: just after saving a custom field in database. Great to call various Dolibarr refresh functions (like $object-&gt;update_price() to refresh the total price).
 * BONUS: if you want to change values saving at creation and stop CF to do the processing and commit, you can use a TRIGGER in the customfield's trigger file (eg: FACTURE_CREATE, and then you can filter which field you want to process specifically, as soon as you do a return this will stop CF to process the fields at creation).
 *
 * Format:
 * All overloading functions must be named with the following convention:
 * customfields_field_$event_$module_$fieldname
 *
 * For example, for the module invoice (facture in Dolibarr, see conf_customfields.lib.php) and a field named 'myfield' and you want to overload the 'editview' event, you can use:
 * customfields_field_editview_facture_myfield
 *
 * A list of modules can be found in conf_customfields.lib.php in the $modulesarray variable.
 *
 */</span></pre></div></div>
<p>Here is a quick example that will replace a field called <b>myfield</b> by a DropdownBox with 5 choices (null or test1-test4) and manage the edition:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw2">function</span> customfields_field_viewfull_mymodule_myfield <span class="br0">(</span><span class="sy0">&amp;</span><span class="re0">$currentmodule</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$object</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$parameters</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$action</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$user</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$idvar</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$rightok</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$field</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$value</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw2">global</span> <span class="re0">$db</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$myarray</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">(</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">''</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'test1'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="nu0">2</span><span class="sy0">,</span> <span class="st_h">'test2'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="nu0">3</span><span class="sy0">,</span> <span class="st_h">'test3'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="nu0">4</span><span class="sy0">,</span> <span class="st_h">'test4'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="br0">)</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">print</span> <span class="re0">$myarray</span><span class="br0">[</span><span class="re0">$value</span><span class="br0">]</span><span class="br0">[</span>1<span class="br0">]</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">function</span> customfields_field_editview_mymodule_myfield <span class="br0">(</span><span class="sy0">&amp;</span><span class="re0">$currentmodule</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$object</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$parameters</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$action</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$user</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$idvar</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$rightok</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$field</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$value</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw2">global</span> <span class="re0">$db</span><span class="sy0">;</span> <span class="co1">// allow to access database functions</span>
&nbsp;
    <span class="re0">$myarray</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">(</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'id'</span><span class="sy0">=&gt;</span><span class="nu0">0</span><span class="sy0">,</span> <span class="st_h">'value'</span><span class="sy0">=&gt;</span><span class="st_h">''</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'id'</span><span class="sy0">=&gt;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'value'</span><span class="sy0">=&gt;</span><span class="st_h">'test1'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'id'</span><span class="sy0">=&gt;</span><span class="nu0">2</span><span class="sy0">,</span> <span class="st_h">'value'</span><span class="sy0">=&gt;</span><span class="st_h">'test2'</span><span class="sy0">,</span> <span class="st_h">'selected'</span><span class="sy0">=&gt;</span>true<span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'id'</span><span class="sy0">=&gt;</span><span class="nu0">3</span><span class="sy0">,</span> <span class="st_h">'value'</span><span class="sy0">=&gt;</span><span class="st_h">'test3'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'id'</span><span class="sy0">=&gt;</span><span class="nu0">4</span><span class="sy0">,</span> <span class="st_h">'value'</span><span class="sy0">=&gt;</span><span class="st_h">'test4'</span><span class="br0">)</span><span class="sy0">,</span>
          <span class="br0">)</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$value</span> <span class="sy0">=</span> <span class="re0">$myarray</span><span class="sy0">;</span> <span class="co1">// just return an array of the format above</span>
<span class="br0">}</span></pre></div></div>
<p>For more complete example cases, you can read the <a href="Module CustomFields - Dolibarr Wiki.html_Cases" title="Module CustomFields Cases">Module_CustomFields_Cases</a> page.
</p><p>Note: beware, save, savefull and aftersave types have different arguments:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw2">function</span> customfields_field_save_mymodule_myfield <span class="br0">(</span><span class="sy0">&amp;</span><span class="re0">$currentmodule</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$object</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$action</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$user</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$field</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$value</span><span class="sy0">,</span> <span class="re0">$fields</span><span class="br0">)</span> <span class="br0">{</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">function</span> customfields_field_savefull_mymodule_myfield <span class="br0">(</span><span class="sy0">&amp;</span><span class="re0">$currentmodule</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$object</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$action</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$user</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$field</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$value</span><span class="sy0">,</span> <span class="re0">$fields</span><span class="br0">)</span> <span class="br0">{</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">function</span> customfields_field_aftersave_mymodule_myfield <span class="br0">(</span><span class="sy0">&amp;</span><span class="re0">$currentmodule</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$object</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$action</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$user</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$customfields</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$field</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="sy0">&amp;</span><span class="re0">$value</span><span class="sy0">,</span> <span class="re0">$fields</span><span class="br0">)</span> <span class="br0">{</span>
<span class="br0">}</span></pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=32" title="Edit section: Custom AJAX Functions">edit</a>]</span> <span class="mw-headline" id="Custom_AJAX_Functions"> Custom AJAX Functions </span></h2>
<p>CustomFields now supports AJAX to send/receive data and dynamically update HTML form's inputs. This section will describe how you can manually implement AJAX for any field, and then it will explain how you can manually manage a cascading field.
</p>
<h3><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=33" title="Edit section: Attaching AJAX to any field">edit</a>]</span> <span class="mw-headline" id="Attaching_AJAX_to_any_field"> Attaching AJAX to any field </span></h3>
<p>Note: you can skip this part if you just want to manually manage a cascading field, but this can help you understand the way it works.
</p><p>An AJAX script can be attached to any field (including non-CustomFields) by using the method:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">ShowInputFieldAjax</span><span class="br0">(</span><span class="re0">$id</span><span class="sy0">,</span> <span class="re0">$phpcallback</span><span class="sy0">,</span> <span class="re0">$on_func</span><span class="sy0">=</span><span class="st0">"change"</span><span class="sy0">,</span> <span class="re0">$request_type</span><span class="sy0">=</span><span class="st0">"post"</span><span class="br0">)</span></pre></div></div>
<p>Where $id is the HTML id of the field you want to attach the AJAX to, and $phpcallback the relative path from Dolibarr's htdocs root folder to the php script that will receive and send back data.
</p><p>The AJAX script will automatically manage sending/receiving of data:
</p>
<ul><li> automatically send all form's inputs values, as well as the current calling field's name and value. The sending happens on change by default, but another event can be set using the $on_event argument. Data will be sent using standard GET or POST.
</li><li> Upon reception of data from the php script, the AJAX script will automatically parse the data and update the HTML fields.
</li></ul>
<p>The PHP callback script must send back to AJAX the data in JSON encoded format, and with with a specific format:
</p>
<ul><li> the data must be an associative array, where each entry's key is the name (not ID!) of an HTML field to update.
</li><li> each entry's value is an associative array, where each sub-entry's key is the action to do. Available actions: 'options', 'value', 'html', 'alert', 'css', 'attr' (see below for more details).
</li><li> each sub-entry's value is the value for this action and HTML field.
</li></ul>
<p>Thus, this approach allows to generically support a wide range of updating actions, managed automatically.
</p><p>You, the implementer, have just to edit the PHP callback script and return an associative array defining what action you want for each field you want to update. This is exactly what has been implemented in the Custom AJAX Functions library, which simplifies even more your job by managing automatically the step described here (generating AJAX and formatting data), so that you can focus on <b>making the data</b>.
</p>
<h3><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=34" title="Edit section: Custom cascading">edit</a>]</span> <span class="mw-headline" id="Custom_cascading"> Custom cascading </span></h3>
<p>To manage cascading manually, a very similar system to the Overloading Functions was implemented: you just have to define a function, with the name including the module and the field's name you want to manage, and CustomFields will call your function instead of managing automatically the AJAX for this field.
</p><p>Note also that you have to enable the Cascade Custom option for this field in the admin panel, else your function won't be called.
</p><p>To make your own Custom Ajax Functions, first rename the following file: /customfields/fields/customfields_fields_ajax_custom.lib.php.example
</p><p>Into (just remove the .example at the end): /customfields/fields/customfields_fields_ajax_custom.lib.php
</p><p>Then open it with your text/php editor.
</p><p>You will find inside all the information you need, here is an excerpt:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="coMULTI">/* Description: here you can define your own interactive manipulation of the customfields on create pages, which will then be sent back to user's browser via AJAX.
 *
 * Guidelines:
 * You can use and modify any variable, CustomFields will then use them afterwards (except for 'full' functions which completely overload CustomFields, so that you must take care of everything on your own).
 * If not using full method, just return an array $result which contain an entry for each of your customfields, and inside the manipulation you want. Eg: $result = array('cf_mycustomfieldname' =&gt; array('options'=&gt;array('option1'=&gt;'optiontitle1', 'option2'=&gt;'optiontitle2'));
 * If using a full method, you have to print the JSON encoded $result array yourself (eg: print(json_encode($result)); ). Please also be aware that it will stop any other printing, thus you can't use more than one full method per module (the other fields will just be silenced, because, well, there's no way to json reencode an array that is already printed, thus it's not possible to append data to what you print).
 *
 * The $result array works this way:
 * - At the first array level, the keys define which customfield's HTML field will be modified. The value contains an array defining the changes that will be done (see 2nd array level).
 * - At the second array level, the keys define what kind of change you will do, and the value is the value of the change. Available change actions are: 'options' to just define the options for a select dropdown list type (the value must be an array where the keys will be the html value, and the value will be the title displayed for this option), 'html' change the whole html, 'value' change the currently selected value, 'alert' shows an error message to the user.
 * You can also store all your alert messages directly at first level, in an array of messages to show, they will all be shown, eg: $results['alert'][] = 'Error message1'; $results['alert'][] = 'Error message2';
 *
 * To access the database using Dolibarr's core functions, you can use:
 * global $db;
 * then you can: $db-&gt;query('SELECT * FROM table'); or use the equivalent $customfields-&gt;fetchAny('*', 'table') for added security against injection.
 *
 * $_POST is sanitized (except when using a full method, then there's no sanitization) and available in the variable $data, but you still should sanitize your inputs if it's coming from users, so please resanitize $_POST depending on your usage (eg, by typing your variables with filter_var() or filter_var_array()).
 *
 * You can also access a variety of other things via globals, like:
 * $conf - contain all Dolibarr's config
 * $user - current user's loggued (can access his rights to check security)
 * $langs - current language of the user (for internationalization)
 *
 * Lastly, you can access the raw GET and POST variables using:
 * $myvar = GETPOST('myvar');
 *
 *
 * Format for the name of your functions:
 * All ajax custom functions must be named with the following convention ($fieldname is the field's name without the prefix 'cf_'):
 * customfields_field_ajax_$module_$fieldname
 *
 * You can also make a generic function that will be called for all fields of the module if there's no specific function for the current customfield
 * customfields_field_ajax_$module_all
 *
 * For example, for the module invoice (called 'facture' in Dolibarr, see conf_customfields.lib.php) and a field named 'myfield', you can use:
 * customfields_field_ajax_facture_myfield
 *
 * And a generic function for the invoice module:
 * customfields_field_ajax_facture_all
 *
 * This generic function will be called for all customfields in the invoice module, except for myfield which will use the specific function defined just above.
 *
 * A list of modules can be found in conf_customfields.lib.php in the $modulesarray variable.
 *
 * IMPORTANT: for a field to call a function here, the option cascade MUST be enabled for this field in the CustomFields admin panel. Also note that these functions will only be called at creation sheet, for editing sheet (when editing a customfield on an object already created), you should also create a custom overloading function of type 'edit'.
 *
 */</span></pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=35" title="Edit section: Adding a new sql data type">edit</a>]</span> <span class="mw-headline" id="Adding_a_new_sql_data_type"> Adding a new sql data type </span></h2>
<p>Here you will learn how to add the native support for a data type.
</p><p>This will allow you to properly manage how the sql data type will be printed and managed by CustomFields.
</p><p><a href="http://wiki.dolibarr.org/index.php/File:Warning.png" class="image"><img alt="Warning.png" src="./Module CustomFields - Dolibarr Wiki_files/Warning.png" width="14" height="14"></a> Warning: this will manage all the fields using this sql data type the same way. If you only need one specific field to be handled differently than the others, you should use the overloading functions (jump to <a href="Module CustomFields - Dolibarr Wiki.html#Overloading_functions:_Adding_your_own_management_code_for_custom_fields" title="Module CustomFields">Module_CustomFields#Overloading_functions:_Adding_your_own_management_code_for_custom_fields</a>).
</p><p><br>
<b>1/ Add the sql data type support in config</b>
</p><p>Why: to show this data type as a choice in the admin page.
</p><p>Open /customfields/conf/conf_customfields.lib.php and search for $sql_datatypes.
</p><p>Edit the $sql_datatypes to add your own type&nbsp;: the key being the sql data type definition (must be sql valid), the value being the name that will be shown to the user (you can choose whatever you want).
Eg:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$sql_datatypes</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">(</span><span class="st_h">'boolean'</span> <span class="sy0">=&gt;</span> <span class="re0">$langs</span><span class="sy0">-&gt;</span><span class="me1">trans</span><span class="br0">(</span><span class="st0">"TrueFalseBox"</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Note: you can set a size or value for the sql data type definition.
Eg: 'enum(\'Yes\',\'No\')' =&gt; $langs-&gt;trans("YesNoBox"), // will produce an enum with the values Yes and No.
Eg2: 'int(11) =&gt; $langs-&gt;trans("SomeNameYouChoose"), // will produce an int field with size 11 bits
</p><p>Result: now the CustomFields module know that you intend to support a new data type, and you can asap use it in the admin page: try to add a custom field with this data type, it should work (if your sql definition is correct). You must now tell it how to manage (edit) it and how to print it.
</p><p><b>2/ Manage the new data type (implement the html input/edit field)</b>
</p><p>Why: CustomFields must know how to manage (save in sql database and show on edit) this particular datatype you've just added.
</p><p>Open /customfields/class/customfields.class.php and edit the showInputField() function. Plenty of examples and comments are provided inside, it should be pretty easy.
</p>
As a guide, you should probably first take a look below the comment: <pre>// Normal non-constrained fields</pre> Below this comment are the simplest data types (above the comment it concerns only constrained fields which are much more dynamic and complicated).
<p>Result: when going to the datasheet of a module supported by CustomFields, try to edit the custom field you created with this data type: you should see the input you've just implemented.
</p><p><b>3/ Print correctly the data type</b>
</p><p>Here we will implement a printing function that will best represent the data type when not editing, just viewing the data in the datasheet.
</p><p>Why: At this stage, your data type should be printed as it is in the database, but you may want to print it differently so that it is more meaningful to a user (eg: for the TrueFalseBox, it's way better to show True or False than 1 or 0).
</p><p>Open /customfields/class/customfields.class.php and edit the printField() function. Comments will guide you.
</p><p>Result: now your data type prints a meaningful representation of the data in the datasheet.
</p><p><b>4/ Optional: translate the name of the data type and the values</b>
</p><p>Why: CustomFields fully supports multilanguage, so you can easily translate or put a longer description with the langs files.
</p><p>You can find them at /customfields/langs/code_CODE/customfields.lang or customfields-user.lang
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=36" title="Edit section: Adding the support of a new module">edit</a>]</span> <span class="mw-headline" id="Adding_the_support_of_a_new_module"> Adding the support of a new module </span></h2>
<p>Please read the <a href="Module CustomFields - Dolibarr Wiki.html_Dev" title="Module CustomFields Dev">CustomFields developpers documentation</a> for the instructions on how to implement the support of a new module in CustomFields (beware: it may require some php abilities in the worst case scenario when hooks and triggers are not yet implemented in the module).
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=37" title="Edit section: Example cases">edit</a>]</span> <span class="mw-headline" id="Example_cases"> Example cases </span></h1>
<p>You can find a compilation of concrete, practical examples on the <a href="Module CustomFields - Dolibarr Wiki.html_Cases" title="Module CustomFields Cases">Module_CustomFields_Cases</a> wiki page.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=38" title="Edit section: Exporting and importing your CustomFields">edit</a>]</span> <span class="mw-headline" id="Exporting_and_importing_your_CustomFields"> Exporting and importing your CustomFields </span></h1>
<p>If you want to export your custom fields into another database, or just make a backup, please carefully read this chapter.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=39" title="Edit section: Exporting and importing in CSV (Excel) via Dolibarr tools">edit</a>]</span> <span class="mw-headline" id="Exporting_and_importing_in_CSV_.28Excel.29_via_Dolibarr_tools"> Exporting and importing in CSV (Excel) via Dolibarr tools </span></h2>
<p>The values of your custom fields can be imported/exported via Dolibarr. Just go to tools &gt; export or import, and then select the module you wish to export/import. Custom fields will automatically be injected into the list of exported/imported fields. Just follow the exporting/importing instructions as usual. Custom fields cannot be exported/imported separately from the module they are related to, you need to export them via the parent module.
</p><p>A nice feature is that you will be able to filter the values out when exporting. Most custom fields types support filtering (such as Text and Constrained), so that you can easily filter your CSV export given a specific value of a custom field, just like any other Dolibarr field.
</p><p>This will allow you to keep your custom fields values in CSV format, readable by Excel. However, you should not rely only on this method to keep a backup of your database, the CSV export/import is better used when you just need to hand your records to a collaborator not using Dolibarr (for example your accountant), but for a regular backup of your Dolibarr system along with your custom fields, you should follow the other instructions below.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=40" title="Edit section: Exporting your SQL data">edit</a>]</span> <span class="mw-headline" id="Exporting_your_SQL_data"> Exporting your SQL data </span></h2>
<p>CustomFields stores all its datas and your custom fields configurations directly inside the database.
</p><p>CustomFields datas and configurations are stored in the <b>same database as Dolibarr</b>, but in totally <b>separate tables</b>.
</p><p>Thus, you can just make a SQL dump of your database, and your custom fields (configuration and datas) will be exported along the way.
</p><p>On the other hand, if you just want to export just the custom fields and not the rest of your Dolibarr database (for example because you configured your custom fields on a test server and now want to upload them to the live environment), you can just export all the tables containing 'customfields' in their name, with something like: LIKE&nbsp;%customfields%
</p><p>This is because everything that is related to CustomFields is labeled with 'customfields' somewhere in the name, so that you can easily single them out of the rest of the Dolibarr standard code and database tables.
</p><p>Note: please note that you should set FOREIGN_KEY_CHECKS = 0 when exporting any Dolibarr's or CustomFields SQL table (please read the Dolibarr wiki about <a href="http://wiki.dolibarr.org/index.php/Backups" title="Backups">Database Backups</a> for a more extensive guide).
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=41" title="Edit section: Exporting your customized CustomFields files">edit</a>]</span> <span class="mw-headline" id="Exporting_your_customized_CustomFields_files"> Exporting your customized CustomFields files </span></h2>
<p>Although CustomFields stores as much as possible its configuration in the database, to give you more freedom of extensibility, there are a few configuration files that are stored directly inside the CustomFields directory.
</p><p>CustomFields separates all its core files from the Dolibarr code, so that they are not mixed up and you can easily make a backup of your CustomFields install by just making a backup of your /htdocs/customfields folder, and that's it!
</p><p>To be more specific, the main files that you should backup are:
</p>
<ul><li> The overloading functions and custom AJAX files if you use overloading functions or custom AJAX to manage some of your custom fields. They are both located inside the /htdocs/customfields/fields/ folder, so that you can just backup the fields folder and you're good to go.
</li></ul>
<ul><li> The languages files if you have translated the labels of your custom fields, which are located inside the following folder: /htdocs/customfields/langs/
</li></ul>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=42" title="Edit section: Updating your Dolibarr/CustomFields">edit</a>]</span> <span class="mw-headline" id="Updating_your_Dolibarr.2FCustomFields"> Updating your Dolibarr/CustomFields </span></h1>
<p>CustomFields was designed to be totally independent from Dolibarr so you don't have to worry when you're updating your Dolibarr install.
</p><p>Also, you can easily update your CustomFields install by just replacing the old files (just make sure that you've made a backup of your modified CustomFields fields and langs files, see the previous chapter). After you updated your CustomFields files, you should <b>disable then re enable CustomFields</b> in the Dolibarr's modules administration page: this is necessary to refresh some of the global parameters.
</p>
<h1><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=43" title="Edit section: Troubleshooting">edit</a>]</span> <span class="mw-headline" id="Troubleshooting"> Troubleshooting </span></h1>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=44" title="Edit section: General advices for troubleshooting">edit</a>]</span> <span class="mw-headline" id="General_advices_for_troubleshooting"> General advices for troubleshooting </span></h2>
<p>If you encounter an error (script not functionning, blank page, etc...), please <b>enable php warnings and error notices</b> and post the errors on the forum if you can't find the solution here or by yourself.
</p><p>Set this in your <b>php.ini</b> file:
</p>
<pre>display_errors = On
error_reporting = E_ALL | E_STRICT
;   E_ALL | E_STRICT  (Show all errors, warnings and notices including coding standards.)
</pre>
<p>Alternatively, in PHP you can use:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw3">error_reporting</span><span class="br0">(</span><span class="kw4">E_ALL</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw3">ini_set</span><span class="br0">(</span><span class="st_h">'display_errors'</span><span class="sy0">,</span> <span class="st_h">'1'</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Or if track_errors = On in your php.ini:</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$php_errormsg</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>You can also check the Dolibarr log: /documents/dolibarr.log (you must enable Dolibarr logging module before).
</p><p>And lastly, you can also print the errors returned by the CustomFields class:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw1">print</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">error</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// This will print all errors concatenated in a single string returned by the CustomFields class</span>
<span class="kw1">print</span><span class="br0">(</span><span class="re0">$customfields</span><span class="sy0">-&gt;</span><span class="me1">errors</span><span class="br0">[</span>0<span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// To print a specific error separately from the rest (can be useful to better understand what happened)</span></pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=45" title="Edit section: Q: I have installed CustomFields but it doesn&#39;t show up in the modules administration panel">edit</a>]</span> <span class="mw-headline" id="Q:_I_have_installed_CustomFields_but_it_doesn.27t_show_up_in_the_modules_administration_panel"> Q: I have installed CustomFields but it doesn't show up in the modules administration panel </span></h2>
<p>A: You probably copied the CustomFields files in the wrong place. Please check that the customfields and customfieldspdftest folders are located just under /dolibarr/htdocs/, or if you have specified an alternate folder in your conf.php file ($dolibarr_main_document_root_alt), place the folders inside this path.
</p><p>Details: For any Dolibarr module to be shown on the Dolibarr's Modules Administration Panel, the only necessary thing is that Dolibarr must find the module descriptor file at the correct place (and with the correct syntax). Since the syntax is taken care of by the developer, if you can't see the module in the admin panel, you should check if you have copied the CustomFields files in the correct location.
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=46" title="Edit section: Q: I&#39;m trying to edit a constrained customfield parameters in the admin configuration page, but everytime I change the constraint it goes back to None ?">edit</a>]</span> <span class="mw-headline" id="Q:_I.27m_trying_to_edit_a_constrained_customfield_parameters_in_the_admin_configuration_page.2C_but_everytime_I.C2.A0change_the_constraint_it_goes_back_to_None_.3F"> Q: I'm trying to edit a constrained customfield parameters in the admin configuration page, but everytime I&nbsp;change the constraint it goes back to None&nbsp;? </span></h2>
<p>A: This is behaviour is probably due to some of your records containing an illegal value for the new constraint. For example, if you switch your customfield's constraint from your products' table containing 100 products to the llx_users table containing 2 users, the database won't know what to do with the illegal values higher than 2, so it won't accept the new constraint and set to None.
In this case, just edit yourself the illegal values, either by fixing them or just deleting all the values for this customfields (but in this case you can just delete the custom field and recreate it, this will indeed delete all values and leave you free to recreate the field with a different constraint).
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=47" title="Edit section: Q: I&#39;m trying to delete a constrained customfield in the admin configuration page, but it doesn&#39;t work!">edit</a>]</span> <span class="mw-headline" id="Q:_I.27m_trying_to_delete_a_constrained_customfield_in_the_admin_configuration_page.2C_but_it_doesn.27t_work.21"> Q: I'm trying to delete a constrained customfield in the admin configuration page, but it doesn't work! </span></h2>
<p>A: This is a normal behaviour. This means that there are a few items in dolibarr (invoices/propale/orders or whatever module you're using this customfield with) that still use this constrained field, and to protect the integrity of your database, your DBMS prevent the deletion.
Simple fix: either reset to an NULL (empty) value all items using the constrained field, or either delete manually in your DBMS (eg: using phpmyadmin) the constraints and then the field.
</p><p>If you want to forcefully delete the field manually, you can use the following sql commands:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="sql source-sql" style="font-family:monospace;"><pre class="de1"><span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">0</span>;
<span class="kw1">ALTER</span> <span class="kw1">TABLE</span> xxx <span class="kw1">DROP</span> <span class="kw1">COLUMN</span> yyy;
<span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">1</span>;</pre></div></div>
<p>SET FOREIGN_KEY_CHECKS = 0 will temporarily disable any key check, leaving you free to delete the sql column.
</p><p>If that doesn't work, you can also totally delete the customfields table by doing:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="sql source-sql" style="font-family:monospace;"><pre class="de1"><span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">0</span>;
<span class="kw1">TRUNCATE</span> <span class="kw1">TABLE</span> llx_themodule_customfields;
<span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">1</span>;</pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=48" title="Edit section: Q: I have a big problem with my fields, and I want to delete all the fields and reinitialize the customfields table">edit</a>]</span> <span class="mw-headline" id="Q:_I_have_a_big_problem_with_my_fields.2C_and_I_want_to_delete_all_the_fields_and_reinitialize_the_customfields_table"> Q: I have a big problem with my fields, and I want to delete all the fields and reinitialize the customfields table </span></h2>
<p>If you have a big problem with a module's custom fields, you may want to start from scratch by deleting the entire custom fields table.
</p><p>You can do this with the following sql commands:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="sql source-sql" style="font-family:monospace;"><pre class="de1"><span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">0</span>;
<span class="kw1">TRUNCATE</span> <span class="kw1">TABLE</span> llx_themodule_customfields;
<span class="kw1">SET</span> FOREIGN_KEY_CHECKS <span class="sy0">=</span> <span class="nu0">1</span>;</pre></div></div>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=49" title="Edit section: Q: CustomFields produces a lot of weird errors anywhere I go even when it is disabled, what should I do?">edit</a>]</span> <span class="mw-headline" id="Q:_CustomFields_produces_a_lot_of_weird_errors_anywhere_I_go_even_when_it_is_disabled.2C_what_should_I_do.3F"> Q: CustomFields produces a lot of weird errors anywhere I go even when it is disabled, what should I do? </span></h2>
<p>CustomFields, but also Dolibarr, expects the database columns to be all lowercase, but on a few systems the result may be returned in uppercase or mixed-case.
</p><p>CustomFields now has a mechanism that should prevent this kind of bug to happen, but if that's the case on your system you can expect to get a lot more errors using any Dolibarr's module, or in fact any php script at all.
</p><p>Please check you SQL DBMS configuration and set it to always return lowercase column names.
</p><p>Eg: For MySQL, check the <b>lower_case_table_names</b> system variable (check the MySQL manual at <b>identifier-case-sensitivity</b>).
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=50" title="Edit section: Q: Whenever I try to create a custom field or a record, I get an error &quot;Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39;&quot;">edit</a>]</span> <span class="mw-headline" id="Q:_Whenever_I_try_to_create_a_custom_field_or_a_record.2C_I_get_an_error_.22Duplicate_entry_.271.27_for_key_.27PRIMARY.27.22"> Q: Whenever I try to create a custom field or a record, I get an error "Duplicate entry '1' for key 'PRIMARY'" </span></h2>
<p>Unluckily, this is one of the worst error you can ever encounter&nbsp;:( This error means that the DBMS can't resolve the primary key checks, and it finds a duplicate even if it shouldn't.
</p><p>This is something that generally happens when either:
</p>
<ul><li> Your SQL queries are malformed, or you are trying to issue a SQL query that the DBMS does not support (DBMS are quite a deal behind the SQL standard in terms of functionnalities).
</li><li> Your database is corrupted
</li></ul>
<p>Since CustomFields was made and extensively tested to avoid malformed SQL queries, it is probable that your database got corrupted. There are various ways to fix this error, but one of the most working solution is to:
</p>
<ul><li> First try to run <b>mysqlcheck</b>
</li><li> If that didn't work out, then first export a backup of your database in a .sql file, then drop your database altogether, and import your backup back into your DBMS. This should fix the problem.
</li></ul>
<p>For more informations, here is an interesting thread:
softwareprojects dot com/resources/programming/t-how-to-fix-mysql-duplicate-entry-for-key-primary-o-1844.html
</p>
<h2><span class="editsection">[<a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit&section=51" title="Edit section: Q: CustomFields Pro is VERY slow when it is enabled, even on modules datasheet where no custom field was created! (aka INFORMATION SCHEMA slowness)">edit</a>]</span> <span class="mw-headline" id="Q:_CustomFields_Pro_is_VERY_slow_when_it_is_enabled.2C_even_on_modules_datasheet_where_no_custom_field_was_created.21_.28aka_INFORMATION_SCHEMA_slowness.29"> Q: CustomFields Pro is VERY slow when it is enabled, even on modules datasheet where no custom field was created! (aka INFORMATION_SCHEMA slowness) </span></h2>
<p>Note the characteristic definition of this problem: CustomFields Pro slows down every datasheet and creation page, even when not any custom field were created for the module!
</p><p>Also this happens only on MySQL with InnoDB enabled (or partially enabled).
</p><p>This slowness happens on some databases for any query to INFORMATION_SCHEMA table. If you are affected by this bug, you can try this simple command:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="kw2">global</span> <span class="re0">$db</span><span class="sy0">;</span>
<span class="re0">$then</span> <span class="sy0">=</span> <span class="kw3">microtime</span><span class="br0">(</span><span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">query</span><span class="br0">(</span><span class="st0">"SELECT 1 FROM INFORMATION_SCHEMA.TABLES LIMIT 1"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re0">$now</span> <span class="sy0">=</span> <span class="kw3">microtime</span><span class="br0">(</span><span class="kw4">true</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="kw3">sprintf</span><span class="br0">(</span><span class="st0">"Elapsed:  <span class="es6">%f</span>"</span><span class="sy0">,</span> <span class="re0">$now</span><span class="sy0">-</span><span class="re0">$then</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>If it takes more than a few milliseconds, then you are affected by the bug.
</p><p>You can fix this bug by setting the following global variable in your MySQL configuration:
</p>
<pre>set global innodb_stats_on_metadata=0;
</pre>
<p>Doing this will change the setting for good and for all applications. You should not have any negative side-effect. A positive side-effect is that other client applications as well as SQL frontends such as phpMyAdmin will be a lot faster.
</p><p>Alternatively, if you can't modify your global configuration (eg: you are on a limited shared web host), you can modify CustomFields to set this variable at runtime: edit /htdocs/customfields/class/customfields.class.php, and search for "INFORMATION_SCHEMA", and everywhere you find a SQL query containing "INFORMATION_SCHEMA", edit it to add <b>in front</b> of the SQL query:
</p>
<pre>set innodb_stats_on_metadata=0;
</pre>
<p>So in the end you should end up with something like this:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="php source-php" style="font-family:monospace;"><pre class="de1"><span class="re0">$db</span><span class="sy0">-&gt;</span><span class="me1">query</span><span class="br0">(</span><span class="st0">"set innodb_stats_on_metadata=0;SELECT 1 FROM INFORMATION_SCHEMA..."</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Another possible alternative would be to use InnoDB plugins to dynamically change the setting. See:
</p>
<pre>dev.mysql.com/doc/innodb-plugin/1.0/en/innodb-other-changes-innodb_stats_on_metadata.html
</pre>
<p><br>
The technical reasons behind this slowness:
</p><p>This is due to a pack of old bugs in MySQL that were never fixed (more specifically connector and I_S queries are suboptimal in MySQL), and which leaks memory and CPU for even small optimized requests. Additionally, InnoDB maintains statistics on metada (which are in most cases useless, except if you do Data Mining on the performance of Relational Models), and these stats incidentally use I_S queries, which hit right into the spot.
</p><p>If you want more information about this bug, check these posts:
</p>
<pre>bugs.mysql.com/bug.php?id=19588
bugs.mysql.com/bug.php?id=27940
www.mysqlperformanceblog.com/2011/12/23/solving-information_schema-slowness/
</pre>

<!-- 
NewPP limit report
Preprocessor node count: 766/1000000
Post-expand include size: 2456/2097152 bytes
Template argument size: 378/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key dolibarrwiki:pcache:idhash:4467-0!*!0!!en!2 and timestamp 20150303121705 -->
<div class="printfooter">
Retrieved from "<a href="Module CustomFields - Dolibarr Wiki.html">Module CustomFields - Dolibarr Wiki.html</a>"</div>
			<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks"><a href="http://wiki.dolibarr.org/index.php/Special:Categories" title="Special:Categories">Categories</a>: <span dir="ltr"><a href="http://wiki.dolibarr.org/index.php/Category:Complementary_modules" title="Category:Complementary modules">Complementary modules</a></span> | <span dir="ltr"><a href="http://wiki.dolibarr.org/index.php?title=Category:CustomFields&action=edit&redlink=1" class="new" title="Category:CustomFields (page does not exist)">CustomFields</a></span> | <span dir="ltr"><a href="http://wiki.dolibarr.org/index.php/Category:FAQ_EN" title="Category:FAQ EN">FAQ EN</a></span></div></div>			<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
	</div>


		<div id="column-one" class="htmldoc-ignore">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
			
				 <li id="ca-nstab-main" class="selected"><a href="Module CustomFields - Dolibarr Wiki.html" title="View the content page [alt-c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="http://wiki.dolibarr.org/index.php?title=Talk:Module_CustomFields&action=edit&redlink=1" title="Discussion about the content page [alt-t]" accesskey="t">Discussion</a></li>
				 <li id="ca-edit"><a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=edit" title="You can edit this page. Please use the preview button before saving [alt-e]" accesskey="e">Edit</a></li>
				 <li id="ca-history"><a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=history" title="Past revisions of this page [alt-h]" accesskey="h">History</a></li>
				 <li id="ca-move"><a href="http://wiki.dolibarr.org/index.php/Special:MovePage/Module_CustomFields" title="Move this page [alt-m]" accesskey="m">Move</a></li>
				 <li id="ca-unwatch"><a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&action=unwatch" title="Remove this page from your watchlist [alt-w]" accesskey="w">Unwatch</a></li>
				 <li id="ca-language"><a href="http://wiki.dolibarr.org/index.php?title=Special:MultiLanguageManager&cible=Module_CustomFields">Language</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
							<li id="pt-userpage"><a href="http://wiki.dolibarr.org/index.php/User:Lrq3000" title="Your user page [alt-.]" accesskey="." class="new">Lrq3000</a></li>
				<li id="pt-mytalk"><a href="http://wiki.dolibarr.org/index.php/User_talk:Lrq3000" title="Your talk page [alt-n]" accesskey="n" class="new">My talk</a></li>
				<li id="pt-preferences"><a href="http://wiki.dolibarr.org/index.php/Special:Preferences" title="Your preferences">My preferences</a></li>
				<li id="pt-watchlist"><a href="http://wiki.dolibarr.org/index.php/Special:Watchlist" title="The list of pages you are monitoring for changes [alt-l]" accesskey="l">My watchlist</a></li>
				<li id="pt-mycontris"><a href="http://wiki.dolibarr.org/index.php/Special:Contributions/Lrq3000" title="List of your contributions [alt-y]" accesskey="y">My contributions</a></li>
				<li id="pt-logout"><a href="http://wiki.dolibarr.org/index.php?title=Special:UserLogout&returnto=Module_CustomFields" title="Log out">Log out</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/skins/dolibarr/dolibarr_125x125.png);" href="http://wiki.dolibarr.org/index.php/Main_Page" title="Visit the main page [alt-z]" accesskey="z"></a>
	</div>

	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-mainpage-description"><a href="http://wiki.dolibarr.org/index.php/Main_Page" title="Visit the main page [alt-z]" accesskey="z">Main page</a></li>
				<li id="n-recentchanges"><a href="http://wiki.dolibarr.org/index.php/Special:RecentChanges" title="The list of recent changes in the wiki [alt-r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://wiki.dolibarr.org/index.php/Special:Random" title="Load a random page [alt-x]" accesskey="x">Random page</a></li>
			</ul>
		</div>
	</div>
<div class="generated-sidebar portlet" id="p-navigation"><h5>In other languages</h5><div class="pBody"><a class="language" href="Module CustomFields - Dolibarr Wiki.html_FR"><img src="./Module CustomFields - Dolibarr Wiki_files/fr.png" class="languageimage" alt="French"></a><!--[if lt IE 7]><span class='popup' onMouseOver="document.getElementById('language_popup').style.visibility = 'visible';"  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><span class="popup" id="popup_anchor"><img src="./Module CustomFields - Dolibarr Wiki_files/es.png" class="languageimage" alt="Spanish"><!--[if lt IE 7]><span  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><div class="cadre_popup" id="language_popup">No translation in Spanish.</div><!--[if lt IE 7]></span><![endif]--></span><!--[if lt IE 7]></span><![endif]--><!--[if lt IE 7]><span class='popup' onMouseOver="document.getElementById('language_popup').style.visibility = 'visible';"  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><span class="popup" id="popup_anchor"><img src="./Module CustomFields - Dolibarr Wiki_files/de.png" class="languageimage" alt="Deutsch"><!--[if lt IE 7]><span  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><div class="cadre_popup" id="language_popup">No translation in Deutsch.</div><!--[if lt IE 7]></span><![endif]--></span><!--[if lt IE 7]></span><![endif]--><!--[if lt IE 7]><span class='popup' onMouseOver="document.getElementById('language_popup').style.visibility = 'visible';"  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><span class="popup" id="popup_anchor"><img src="./Module CustomFields - Dolibarr Wiki_files/it.png" class="languageimage" alt="Italian"><!--[if lt IE 7]><span  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><div class="cadre_popup" id="language_popup">No translation in Italian.</div><!--[if lt IE 7]></span><![endif]--></span><!--[if lt IE 7]></span><![endif]--><!--[if lt IE 7]><span class='popup' onMouseOver="document.getElementById('language_popup').style.visibility = 'visible';"  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><span class="popup" id="popup_anchor"><img src="./Module CustomFields - Dolibarr Wiki_files/el.png" class="languageimage" alt="Greek"><!--[if lt IE 7]><span  onmouseout="document.getElementById('language_popup').style.visibility = 'hidden';"><![endif]--><div class="cadre_popup" id="language_popup">No translation in Greek.</div><!--[if lt IE 7]></span><![endif]--></span><!--[if lt IE 7]></span><![endif]-->
</div>
</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wiki.dolibarr.org/index.php" id="searchform">
				<input type="hidden" name="title" value="Special:Search">
				<input id="searchInput" title="Search Dolibarr Wiki" accesskey="f" type="search" name="search">
				<input type="submit" name="go" class="searchButton" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists">
				<div><a href="http://wiki.dolibarr.org/index.php/Special:Search" rel="search">Advanced search</a></div>
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wiki.dolibarr.org/index.php/Special:WhatLinksHere/Module_CustomFields" title="List of all wiki pages that link here [alt-j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wiki.dolibarr.org/index.php/Special:RecentChangesLinked/Module_CustomFields" title="Recent changes in pages linked from this page [alt-k]" accesskey="k">Related changes</a></li>
<li id="t-upload"><a href="http://wiki.dolibarr.org/index.php/Special:Upload" title="Upload files [alt-u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="http://wiki.dolibarr.org/index.php/Special:SpecialPages" title="List of all special pages [alt-q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&printable=yes" title="Printable version of this page [alt-p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="http://wiki.dolibarr.org/index.php?title=Module_CustomFields&oldid=33197" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
<br><!-- <div class='generated-sidebar portlet' id='p-navigation-donation' style='text-align: center'>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="8978561">
<input type="image" src="http://wiki.dolibarr.org/upload/5/5c/Paypal.png" border="0" name="submit" alt="Help Dolibarr making a donation">
</form>
</div>
 -->
<div class="generated-sidebar portlet" id="p-navigation">
<h5>
Social networks
</h5>
<div class="pBody" align="center">

<!--<div style="padding: 3px">
<g:plus href="https://plus.google.com/+DolibarrOrg" width="100" height="131"></g:plus>
</div>-->

<div style="padding: 1px">
<center>
<a href="https://plus.google.com/+DolibarrOrg" target="_blank" rel="nofollow"><img src="./Module CustomFields - Dolibarr Wiki_files/google.png" width="24px" height="24px" alt="Follow us on Google+"></a>

<a href="http://www.facebook.com/dolibarr" target="_blank" rel="nofollow"><img src="./Module CustomFields - Dolibarr Wiki_files/facebook.png" width="24px" height="24px" alt="Follow us on Facebook"></a>

<a href="http://www.linkedin.com/groups?gid=2743052" target="_blank" rel="nofollow"><img src="./Module CustomFields - Dolibarr Wiki_files/linkedin.png" width="24px" height="24px" alt="Follow us on LinkedIn"></a>

<a href="http://twitter.com/dolibarr" target="_blank" rel="nofollow"><img src="./Module CustomFields - Dolibarr Wiki_files/twitter.png" width="24px" height="24px" alt="Follow us on Twitter"></a>
</center>
</div>

</div>
</div>

<br><br>

<div class="generated-sidebar portlet" id="p-navigation-adsense" style="text-align: center">
<div class="pBody">
<script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- PUBSKYDOLIBARRWIKI2 -->
<ins class="adsbygoogle" style="display:inline-block;width:160px;height:600px" data-ad-client="ca-pub-1071905880519467" data-ad-slot="7811259314"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>

<!-- End LDR -->



	</div><!-- end of the left (by default at least) one-column -->
	
	<div class="visualClear"></div>

		<div id="footer" class="htmldoc-ignore">
				
	<ul id="f-list">
						<li id="lastmod"> This page was last modified on 3 March 2015, at 14:17.</li>
							<li id="viewcount">This page has been accessed 29,345 times.</li>
							<li id="copyright">Content is available under <a href="http://creativecommons.org/licenses/by-sa/4.0/" class="external ">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
			
			<!-- LDR Add author -->
			<li><a rel="author" href="https://plus.google.com/+LaurentDestailleur?rel=author">Created or moderated by Eldy</a></li>			<!-- End Add author -->

	</ul>
		</div>	<!-- End div footer -->

</div>



<script src="./Module CustomFields - Dolibarr Wiki_files/load.php"></script><script src="./Module CustomFields - Dolibarr Wiki_files/load(1).php"></script>
<script>if ( window.mediaWiki ) {
	mediaWiki.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Module_CustomFields", "wgTitle": "Module CustomFields", "wgAction": "view", "wgArticleId": 4467, "wgIsArticle": true, "wgUserName": "Lrq3000", "wgUserGroups": ["*", "user", "autoconfirmed", "emailconfirmed"], "wgCurRevisionId": 33197, "wgCategories": ["Complementary modules", "CustomFields", "FAQ EN"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": []});
}
</script>
<script>if ( window.mediaWiki ) {
	mediaWiki.loader.load(["mediawiki.util", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax", "mediawiki.legacy.ajaxwatch"]);
	mediaWiki.loader.go();
}
</script><script type="text/javascript" src="./Module CustomFields - Dolibarr Wiki_files/load(2).php"></script>

<script>if ( window.mediaWiki ) {
	mediaWiki.user.options.set({"quickbar":0,"underline":2,"cols":80,"rows":"40","searchlimit":20,"contextlines":5,"contextchars":50,"skin":"dolibarr","math":1,"rcdays":7,"rclimit":50,"wllimit":250,"highlightbroken":1,"stubthreshold":0,"previewontop":1,"editsection":1,"editsectiononrightclick":0,"showtoc":1,"showtoolbar":1,"date":"default","imagesize":2,"thumbsize":2,"rememberpassword":0,"enotifwatchlistpages":0,"enotifusertalkpages":1,"enotifminoredits":0,"enotifrevealaddr":0,"shownumberswatching":1,"fancysig":0,"externaleditor":0,"externaldiff":0,"showjumplinks":0,"numberheadings":0,"uselivepreview":0,"watchlistdays":3,"editfont":"default","gender":"unknown","variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,
	"searchNs100":true,"searchNs101":false,"searchNs110":false,"searchNs111":false,"searchNs120":false,"searchNs121":false,"nickname":"","timecorrection":"Offset|120","usenewrc":"1","watchlisttoken":"38022c1a5c20a559a346a171c13a3607a4202408"});;mediaWiki.loader.state({"user.options":"ready"});
}
</script><!-- Served in 9.929 secs. -->

</body></html>